<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="若依框架学习笔记"><meta name="keywords" content="java"><meta name="author" content="qinwei"><meta name="copyright" content="qinwei"><title>若依框架学习笔记 | QW's Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '5.4.2'
} </script><meta name="generator" content="Hexo 5.4.2"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF%E5%9B%BE"><span class="toc-text">1. 学习路线图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%A1%86%E6%9E%B6%E8%BF%90%E8%A1%8C"><span class="toc-text">2. 框架运行</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E5%90%8E%E7%AB%AF%E8%BF%90%E8%A1%8C"><span class="toc-text">2.1 后端运行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E5%89%8D%E7%AB%AF%E8%BF%90%E8%A1%8C"><span class="toc-text">2.2 前端运行</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E9%A1%B9%E7%9B%AE%E5%88%86%E6%9E%90"><span class="toc-text">3. 项目分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-text">3.1.文件结构</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-RBAC%E6%A8%A1%E5%9E%8B"><span class="toc-text">4.RBAC模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8"><span class="toc-text">5.数据字典</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-text">6.拦截器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-%E5%89%8D%E7%AB%AF%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-text">6.1 前端拦截器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-%E5%93%8D%E5%BA%94%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-text">6.2 响应拦截器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-%E5%90%8E%E7%AB%AF%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-text">6.2 后端拦截器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E7%99%BB%E5%BD%95%E6%B5%81%E7%A8%8B"><span class="toc-text">7.登录流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-%E7%99%BB%E5%BD%95%E6%8A%80%E6%9C%AF%E6%A0%88%E5%88%86%E6%9E%90"><span class="toc-text">7.1 登录技术栈分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-token%E6%A0%A1%E9%AA%8C"><span class="toc-text">7.2 token校验</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E6%8C%89%E9%92%AE%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6"><span class="toc-text">8.按钮权限控制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-%E5%89%8D%E7%AB%AF"><span class="toc-text">8.1 前端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-%E5%90%8E%E7%AB%AF"><span class="toc-text">8.2 后端</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#8-2-1-%E6%8E%A5%E5%8F%A3%E6%9D%83%E9%99%90"><span class="toc-text">8.2.1 接口权限</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%96%B9%E6%B3%95"><span class="toc-text">权限方法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#8-2-1-%E6%95%B0%E6%8D%AE%E6%9D%83%E9%99%90"><span class="toc-text">8.2.1 数据权限</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98"><span class="toc-text">9. 项目实战</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/20211013182113.JPG"></div><div class="author-info__name text-center">qinwei</div><div class="author-info__description text-center"></div><div class="follow-button"><a target="_blank" rel="noopener" href="https://github.com/qw-null">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">155</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">44</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">28</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/qw-null/BlogImages/223.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">QW's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">首页</a><a class="site-page" href="/categories">分类</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/archives">创作时间线</a><a class="site-page" target="_blank" rel="noopener" href="https://github.com/qw-null">Github</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">若依框架学习笔记</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2024-02-19</time><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">3.9k</span><span class="post-meta__separator">|</span><span>阅读时长: 17 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="1-学习路线图"><a href="#1-学习路线图" class="headerlink" title="1. 学习路线图"></a>1. 学习路线图</h2><p><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/image-20240122093531148.png" alt="image-20240122093531148"></p>
<h2 id="2-框架运行"><a href="#2-框架运行" class="headerlink" title="2. 框架运行"></a>2. 框架运行</h2><p><a target="_blank" rel="noopener" href="https://ruoyi.vip/">若依框架官网</a></p>
<h4 id="2-1-后端运行"><a href="#2-1-后端运行" class="headerlink" title="2.1 后端运行"></a>2.1 后端运行</h4><p>0⃣️  数据库配置</p>
<p>配置文件位置：ruoyi-adimn/src/main/resources/application-druid.yml</p>
<p>配置步骤：</p>
<p>1⃣️  本地创建数据库ry-vue（通过配置文件得知）</p>
<img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/image-20240122094833492.png" alt="image-20240122094833492" style="zoom:50%;" />

<p>2⃣️  运行sql脚本 （位置：sql/ry_20231130.sql）</p>
<p>✅ 运行完成后数据库表即可建立完成</p>
<p>3⃣️  查看redis配置 （位置：ruoyi-adimn/src/main/resources/application.yml）</p>
<img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/image-20240122095233790.png" alt="image-20240122095233790" style="zoom:50%;" />

<p>本地启动redis</p>
<p>4⃣️  启动项目</p>
<p>启动类的位置：ruoyi-adimn/src/main/java/com/ruoyi/RuoYiApplication</p>
<h4 id="2-2-前端运行"><a href="#2-2-前端运行" class="headerlink" title="2.2 前端运行"></a>2.2 前端运行</h4><p>前端目录：RUOYI-UI</p>
<p>下载依赖：<code>npm install</code></p>
<p>运行前端代码：<code>npm run dev</code></p>
<h2 id="3-项目分析"><a href="#3-项目分析" class="headerlink" title="3. 项目分析"></a>3. 项目分析</h2><p>RuoYi-Vue 是一个单体项目，但是根据多模块进行管理，将不同的模块进行隔离</p>
<p>其中，<code> ruoyi-quartz</code>和<code> ruoyi-quartz</code>可以进行删除，其余模块对其没有任何依赖</p>
<h4 id="3-1-文件结构"><a href="#3-1-文件结构" class="headerlink" title="3.1.文件结构"></a>3.1.文件结构</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">com.ruoyi     </span><br><span class="line">├── common            // 工具类</span><br><span class="line">│       └── annotation                    // 自定义注解</span><br><span class="line">│       └── config                        // 全局配置</span><br><span class="line">│       └── constant                      // 通用常量</span><br><span class="line">│       └── core                          // 核心控制</span><br><span class="line">│       └── enums                         // 通用枚举</span><br><span class="line">│       └── exception                     // 通用异常</span><br><span class="line">│       └── filter                        // 过滤器处理</span><br><span class="line">│       └── utils                         // 通用类处理</span><br><span class="line">├── framework         // 框架核心</span><br><span class="line">│       └── aspectj                       // 注解实现</span><br><span class="line">│       └── config                        // 系统配置</span><br><span class="line">│       └── datasource                    // 数据权限</span><br><span class="line">│       └── interceptor                   // 拦截器</span><br><span class="line">│       └── manager                       // 异步处理</span><br><span class="line">│       └── security                      // 权限控制</span><br><span class="line">│       └── web                           // 前端控制</span><br><span class="line">├── ruoyi-generator   // 代码生成（可移除）</span><br><span class="line">├── ruoyi-quartz      // 定时任务（可移除）</span><br><span class="line">├── ruoyi-system      // 系统代码</span><br><span class="line">├── ruoyi-admin       // 后台服务</span><br></pre></td></tr></table></figure>

<p><strong>PS：</strong></p>
<p>1.代码分开存放：controller（位置：<code>ruoyi-admin/src/main/java/com/ruoyi/web/controller/</code>），controller调用的service、mapper、domain在<code>ruoyi-system</code>目录下</p>
<p>2.<code>ruoyi-admin</code>使用到<code>framework</code>内容</p>
<p>在<code>ruoyi-admin</code>的<code>pom.xml</code>中引入</p>
<img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/image-20240122103339887.png" alt="image-20240122103339887" style="zoom:50%;" />

<p>同样在<code>framework</code>的<code>pom.xml</code>中引入<code>ruoyi-system</code></p>
<img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/image-20240122103701409.png" alt="image-20240122103701409" style="zoom:50%;" />

<h2 id="4-RBAC模型"><a href="#4-RBAC模型" class="headerlink" title="4.RBAC模型"></a>4.RBAC模型</h2><ul>
<li>若依框架的权限管理功能是基于<strong>RBAC</strong>来实现的，即：系统中所有的权限，都是基于角色来控制的</li>
<li>框架对权限的控制，不仅支持菜单的功能，还支持菜单中的每一个按钮的权限控制</li>
</ul>
<p>RBAC（基于角色的访问控制）模型包含的表有下面五张：</p>
<ol>
<li><p>用户表 </p>
</li>
<li><p>角色表</p>
</li>
<li><p>菜单表</p>
</li>
<li><p>用户角色关联表</p>
</li>
<li><p>角色菜单关联表</p>
</li>
</ol>
<img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/image-20240122110117943.png" alt="image-20240122110117943" style="zoom:50%;" />

<p>查询当前登录用户的所拥有的权限菜单（登录人ID：2）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sys_menu t1</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> sys_role_menu t2 <span class="keyword">on</span> t1.menu_id <span class="operator">=</span> t2.menu_id</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> sys_user_role t3 <span class="keyword">on</span> t2.role_id <span class="operator">=</span> t3.role_id</span><br><span class="line"><span class="keyword">where</span> t3.user_id <span class="operator">=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h2 id="5-数据字典"><a href="#5-数据字典" class="headerlink" title="5.数据字典"></a>5.数据字典</h2><p>数据字典的功能由两张表组成：</p>
<ol>
<li>sys_dict_type：字典类型表</li>
<li>sys_dict_data：字典数量表</li>
</ol>
<p>两者之间的关系：<code>sys_dict_type</code>表的<code>dict_type</code>字段关联<code>sys_dict_data</code>的<code>dict_type</code>字段</p>
<img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/image-20240122112919670.png" alt="image-20240122112919670" style="zoom:50%;" />



<h2 id="6-拦截器"><a href="#6-拦截器" class="headerlink" title="6.拦截器"></a>6.拦截器</h2><h4 id="6-1-前端拦截器"><a href="#6-1-前端拦截器" class="headerlink" title="6.1 前端拦截器"></a>6.1 前端拦截器</h4><p>前端拦截器分为 前置拦截器 和 响应拦截器</p>
<p><strong>前置拦截器</strong></p>
<p>前置拦截器的代码写在<code>request.js</code>文件中，路径为 src - utils - request.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// request拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 是否需要设置 token</span></span><br><span class="line">  <span class="keyword">const</span> isToken = (config.<span class="property">headers</span> || &#123;&#125;).<span class="property">isToken</span> === <span class="literal">false</span></span><br><span class="line">  <span class="comment">// 是否需要防止数据重复提交</span></span><br><span class="line">  <span class="keyword">const</span> isRepeatSubmit = (config.<span class="property">headers</span> || &#123;&#125;).<span class="property">repeatSubmit</span> === <span class="literal">false</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">getToken</span>() &amp;&amp; !isToken) &#123;</span><br><span class="line">    config.<span class="property">headers</span>[<span class="string">&#x27;Authorization&#x27;</span>] = <span class="string">&#x27;Bearer &#x27;</span> + <span class="title function_">getToken</span>() <span class="comment">// 让每个请求携带自定义token 请根据实际情况自行修改</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// get请求映射params参数</span></span><br><span class="line">  <span class="keyword">if</span> (config.<span class="property">method</span> === <span class="string">&#x27;get&#x27;</span> &amp;&amp; config.<span class="property">params</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> url = config.<span class="property">url</span> + <span class="string">&#x27;?&#x27;</span> + <span class="title function_">tansParams</span>(config.<span class="property">params</span>);</span><br><span class="line">    url = url.<span class="title function_">slice</span>(<span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">    config.<span class="property">params</span> = &#123;&#125;;</span><br><span class="line">    config.<span class="property">url</span> = url;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!isRepeatSubmit &amp;&amp; (config.<span class="property">method</span> === <span class="string">&#x27;post&#x27;</span> || config.<span class="property">method</span> === <span class="string">&#x27;put&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">const</span> requestObj = &#123;</span><br><span class="line">      <span class="attr">url</span>: config.<span class="property">url</span>,</span><br><span class="line">      <span class="attr">data</span>: <span class="keyword">typeof</span> config.<span class="property">data</span> === <span class="string">&#x27;object&#x27;</span> ? <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(config.<span class="property">data</span>) : config.<span class="property">data</span>,</span><br><span class="line">      <span class="attr">time</span>: <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> requestSize = <span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(requestObj)).<span class="property">length</span>; <span class="comment">// 请求数据大小</span></span><br><span class="line">    <span class="keyword">const</span> limitSize = <span class="number">5</span> * <span class="number">1024</span> * <span class="number">1024</span>; <span class="comment">// 限制存放数据5M</span></span><br><span class="line">    <span class="keyword">if</span> (requestSize &gt;= limitSize) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">`[<span class="subst">$&#123;config.url&#125;</span>]: `</span> + <span class="string">&#x27;请求数据大小超出允许的5M限制，无法进行防重复提交验证。&#x27;</span>)</span><br><span class="line">      <span class="keyword">return</span> config;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> sessionObj = cache.<span class="property">session</span>.<span class="title function_">getJSON</span>(<span class="string">&#x27;sessionObj&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (sessionObj === <span class="literal">undefined</span> || sessionObj === <span class="literal">null</span> || sessionObj === <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">      cache.<span class="property">session</span>.<span class="title function_">setJSON</span>(<span class="string">&#x27;sessionObj&#x27;</span>, requestObj)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> s_url = sessionObj.<span class="property">url</span>;                  <span class="comment">// 请求地址</span></span><br><span class="line">      <span class="keyword">const</span> s_data = sessionObj.<span class="property">data</span>;                <span class="comment">// 请求数据</span></span><br><span class="line">      <span class="keyword">const</span> s_time = sessionObj.<span class="property">time</span>;                <span class="comment">// 请求时间</span></span><br><span class="line">      <span class="keyword">const</span> interval = <span class="number">1000</span>;                         <span class="comment">// 间隔时间(ms)，小于此时间视为重复提交</span></span><br><span class="line">      <span class="keyword">if</span> (s_data === requestObj.<span class="property">data</span> &amp;&amp; requestObj.<span class="property">time</span> - s_time &lt; interval &amp;&amp; s_url === requestObj.<span class="property">url</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> message = <span class="string">&#x27;数据正在处理，请勿重复提交&#x27;</span>;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">`[<span class="subst">$&#123;s_url&#125;</span>]: `</span> + message)</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(message))</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        cache.<span class="property">session</span>.<span class="title function_">setJSON</span>(<span class="string">&#x27;sessionObj&#x27;</span>, requestObj)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> config</span><br><span class="line">&#125;, <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error)</span><br><span class="line">    <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>前置拦截器完成功能：</p>
<ol>
<li>在请求头中添加token</li>
<li>get请求映射params参数</li>
<li>阻止重复请求重复提交（虽然前端做了，但一般后台也需要做借口幂等性校验）</li>
</ol>
<h4 id="6-2-响应拦截器"><a href="#6-2-响应拦截器" class="headerlink" title="6.2 响应拦截器"></a>6.2 响应拦截器</h4><p>响应拦截器也在<code>request.js</code>文件中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 未设置状态码则默认成功状态</span></span><br><span class="line">    <span class="keyword">const</span> code = res.<span class="property">data</span>.<span class="property">code</span> || <span class="number">200</span>;</span><br><span class="line">    <span class="comment">// 获取错误信息</span></span><br><span class="line">    <span class="keyword">const</span> msg = errorCode[code] || res.<span class="property">data</span>.<span class="property">msg</span> || errorCode[<span class="string">&#x27;default&#x27;</span>]</span><br><span class="line">    <span class="comment">// 二进制数据则直接返回</span></span><br><span class="line">    <span class="keyword">if</span> (res.<span class="property">request</span>.<span class="property">responseType</span> ===  <span class="string">&#x27;blob&#x27;</span> || res.<span class="property">request</span>.<span class="property">responseType</span> ===  <span class="string">&#x27;arraybuffer&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="property">data</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (code === <span class="number">401</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!isRelogin.<span class="property">show</span>) &#123;</span><br><span class="line">        isRelogin.<span class="property">show</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="title class_">MessageBox</span>.<span class="title function_">confirm</span>(<span class="string">&#x27;登录状态已过期，您可以继续留在该页面，或者重新登录&#x27;</span>, <span class="string">&#x27;系统提示&#x27;</span>, &#123; <span class="attr">confirmButtonText</span>: <span class="string">&#x27;重新登录&#x27;</span>, <span class="attr">cancelButtonText</span>: <span class="string">&#x27;取消&#x27;</span>, <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span> &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          isRelogin.<span class="property">show</span> = <span class="literal">false</span>;</span><br><span class="line">          store.<span class="title function_">dispatch</span>(<span class="string">&#x27;LogOut&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            location.<span class="property">href</span> = <span class="string">&#x27;/index&#x27;</span>;</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;).<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        isRelogin.<span class="property">show</span> = <span class="literal">false</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="string">&#x27;无效的会话，或者会话已过期，请重新登录。&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (code === <span class="number">500</span>) &#123;</span><br><span class="line">      <span class="title class_">Message</span>(&#123; <span class="attr">message</span>: msg, <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span> &#125;)</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(msg))</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (code === <span class="number">601</span>) &#123;</span><br><span class="line">      <span class="title class_">Message</span>(&#123; <span class="attr">message</span>: msg, <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span> &#125;)</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (code !== <span class="number">200</span>) &#123;</span><br><span class="line">      <span class="title class_">Notification</span>.<span class="title function_">error</span>(&#123; <span class="attr">title</span>: msg &#125;)</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="property">data</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;err&#x27;</span> + error)</span><br><span class="line">    <span class="keyword">let</span> &#123; message &#125; = error;</span><br><span class="line">    <span class="keyword">if</span> (message == <span class="string">&quot;Network Error&quot;</span>) &#123;</span><br><span class="line">      message = <span class="string">&quot;后端接口连接异常&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.<span class="title function_">includes</span>(<span class="string">&quot;timeout&quot;</span>)) &#123;</span><br><span class="line">      message = <span class="string">&quot;系统接口请求超时&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.<span class="title function_">includes</span>(<span class="string">&quot;Request failed with status code&quot;</span>)) &#123;</span><br><span class="line">      message = <span class="string">&quot;系统接口&quot;</span> + message.<span class="title function_">substr</span>(message.<span class="property">length</span> - <span class="number">3</span>) + <span class="string">&quot;异常&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">Message</span>(&#123; <span class="attr">message</span>: message, <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>, <span class="attr">duration</span>: <span class="number">5</span> * <span class="number">1000</span> &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="6-2-后端拦截器"><a href="#6-2-后端拦截器" class="headerlink" title="6.2 后端拦截器"></a>6.2 后端拦截器</h4><p>路径：<code>ruoyi-framework/src/main/java/com/ruoyi/framework/interceptor/RepeatSubmitInterceptor.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ruoyi.framework.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.method.HandlerMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson2.JSON;</span><br><span class="line"><span class="keyword">import</span> com.ruoyi.common.annotation.RepeatSubmit;</span><br><span class="line"><span class="keyword">import</span> com.ruoyi.common.core.domain.AjaxResult;</span><br><span class="line"><span class="keyword">import</span> com.ruoyi.common.utils.ServletUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 防止重复提交拦截器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ruoyi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">RepeatSubmitInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (handler <span class="keyword">instanceof</span> HandlerMethod)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">HandlerMethod</span> <span class="variable">handlerMethod</span> <span class="operator">=</span> (HandlerMethod) handler;</span><br><span class="line">            <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> handlerMethod.getMethod();</span><br><span class="line">            <span class="type">RepeatSubmit</span> <span class="variable">annotation</span> <span class="operator">=</span> method.getAnnotation(RepeatSubmit.class);</span><br><span class="line">            <span class="keyword">if</span> (annotation != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.isRepeatSubmit(request, annotation))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">AjaxResult</span> <span class="variable">ajaxResult</span> <span class="operator">=</span> AjaxResult.error(annotation.message());</span><br><span class="line">                    ServletUtils.renderString(response, JSON.toJSONString(ajaxResult));</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 验证是否重复提交由子类实现具体的防重复提交的规则</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request 请求信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> annotation 防重复注解参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">isRepeatSubmit</span><span class="params">(HttpServletRequest request, RepeatSubmit annotation)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-登录流程"><a href="#7-登录流程" class="headerlink" title="7.登录流程"></a>7.登录流程</h2><p>登录流程图：</p>
<img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/image-20240123090704845.png" alt="image-20240123090704845" style="zoom:50%;" />

<h4 id="7-1-登录技术栈分析"><a href="#7-1-登录技术栈分析" class="headerlink" title="7.1 登录技术栈分析"></a>7.1 登录技术栈分析</h4><p>上述流程中，登录成功后，最后会给前端返回一个token，会调用TokenService的createToken方法，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*位置： ruoyi-framework/src/main/java/com/ruoyi/framework/web/service/TokenService.java */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建令牌</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> loginUser 用户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 令牌</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">createToken</span><span class="params">(LoginUser loginUser)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> IdUtils.fastUUID();</span><br><span class="line">    loginUser.setToken(token);</span><br><span class="line">    setUserAgent(loginUser);</span><br><span class="line">    refreshToken(loginUser);</span><br><span class="line"></span><br><span class="line">    Map&lt;String, Object&gt; claims = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    claims.put(Constants.LOGIN_USER_KEY, token);</span><br><span class="line">    <span class="keyword">return</span> createToken(claims);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从数据声明生成令牌</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> claims 数据声明</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 令牌</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> String <span class="title function_">createToken</span><span class="params">(Map&lt;String, Object&gt; claims)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> Jwts.builder()</span><br><span class="line">            .setClaims(claims)</span><br><span class="line">            .signWith(SignatureAlgorithm.HS512, secret).compact();</span><br><span class="line">    <span class="keyword">return</span> token;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>实际上<code>createToken</code>方法就是采用JWT的方式生成令牌返回给前端</p>
<h4 id="7-2-token校验"><a href="#7-2-token校验" class="headerlink" title="7.2 token校验"></a>7.2 token校验</h4><p>登录成功后，我们每一个请求到后台时，都需要对token进行权限校验，若依框架对token的校验是用过滤器实现的</p>
<p>过滤器位置：<code>ruoyi-framework/src/main/java/com/ruoyi/framework/security/filter/JwtAuthenticationTokenFilter.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ruoyi.framework.security.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.WebAuthenticationDetailsSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.filter.OncePerRequestFilter;</span><br><span class="line"><span class="keyword">import</span> com.ruoyi.common.core.domain.model.LoginUser;</span><br><span class="line"><span class="keyword">import</span> com.ruoyi.common.utils.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> com.ruoyi.common.utils.StringUtils;</span><br><span class="line"><span class="keyword">import</span> com.ruoyi.framework.web.service.TokenService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * token过滤器 验证token有效性</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ruoyi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtAuthenticationTokenFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TokenService tokenService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain chain)</span></span><br><span class="line">            <span class="keyword">throws</span> ServletException, IOException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">LoginUser</span> <span class="variable">loginUser</span> <span class="operator">=</span> tokenService.getLoginUser(request);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotNull(loginUser) &amp;&amp; StringUtils.isNull(SecurityUtils.getAuthentication()))</span><br><span class="line">        &#123;</span><br><span class="line">            tokenService.verifyToken(loginUser);</span><br><span class="line">            <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">authenticationToken</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(loginUser, <span class="literal">null</span>, loginUser.getAuthorities());</span><br><span class="line">            authenticationToken.setDetails(<span class="keyword">new</span> <span class="title class_">WebAuthenticationDetailsSource</span>().buildDetails(request));</span><br><span class="line">            SecurityContextHolder.getContext().setAuthentication(authenticationToken);</span><br><span class="line">        &#125;</span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>getLoginUser</code>方法作用：</p>
<ol>
<li>从请求头中获取到<code>token</code>，然后解析得到我们设置进去的<code>UUID</code></li>
<li>然后再以<code>UUID</code>作为<code>key</code>去<code>Redis</code>中获取到登录账号信息</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 位置：ruoyi-framework/src/main/java/com/ruoyi/framework/web/service/TokenService.java */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取用户身份信息</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 用户信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> LoginUser <span class="title function_">getLoginUser</span><span class="params">(HttpServletRequest request)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 获取请求携带的令牌</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> getToken(request);</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isNotEmpty(token))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> parseToken(token);</span><br><span class="line">            <span class="comment">// 解析对应的权限以及用户信息</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> (String) claims.get(Constants.LOGIN_USER_KEY);</span><br><span class="line">            <span class="type">String</span> <span class="variable">userKey</span> <span class="operator">=</span> getTokenKey(uuid);</span><br><span class="line">            <span class="type">LoginUser</span> <span class="variable">user</span> <span class="operator">=</span> redisCache.getCacheObject(userKey);</span><br><span class="line">            <span class="keyword">return</span> user;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            log.error(<span class="string">&quot;获取用户信息异常&#x27;&#123;&#125;&#x27;&quot;</span>, e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>verifyToken</code>方法作用：校验令牌超时时间和当前时间的差值，如果小于20分钟的话，就会刷新令牌的超时时间</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 验证令牌有效期，相差不足20分钟，自动刷新缓存</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> loginUser</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 令牌</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">verifyToken</span><span class="params">(LoginUser loginUser)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">expireTime</span> <span class="operator">=</span> loginUser.getExpireTime();</span><br><span class="line">    <span class="type">long</span> <span class="variable">currentTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">if</span> (expireTime - currentTime &lt;= MILLIS_MINUTE_TEN)</span><br><span class="line">    &#123;</span><br><span class="line">        refreshToken(loginUser);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-按钮权限控制"><a href="#8-按钮权限控制" class="headerlink" title="8.按钮权限控制"></a>8.按钮权限控制</h2><p>若依框架不仅对菜单实现了权限控制，还对按钮实现了权限控制。</p>
<h4 id="8-1-前端"><a href="#8-1-前端" class="headerlink" title="8.1 前端"></a>8.1 前端</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-row :gutter=&quot;10&quot; class=&quot;mb8&quot;&gt;</span><br><span class="line">    &lt;el-col :span=&quot;1.5&quot;&gt;</span><br><span class="line">      &lt;el-button</span><br><span class="line">        type=&quot;primary&quot;</span><br><span class="line">        plain</span><br><span class="line">        icon=&quot;el-icon-plus&quot;</span><br><span class="line">        size=&quot;mini&quot;</span><br><span class="line">        @click=&quot;handleAdd&quot;</span><br><span class="line">        v-hasPermi=&quot;[&#x27;system:user:add&#x27;]&quot;</span><br><span class="line">      &gt;新增&lt;/el-button&gt;</span><br><span class="line">    &lt;/el-col&gt;</span><br><span class="line">    &lt;el-col :span=&quot;1.5&quot;&gt;</span><br><span class="line">      &lt;el-button</span><br><span class="line">        type=&quot;success&quot;</span><br><span class="line">        plain</span><br><span class="line">        icon=&quot;el-icon-edit&quot;</span><br><span class="line">        size=&quot;mini&quot;</span><br><span class="line">        :disabled=&quot;single&quot;</span><br><span class="line">        @click=&quot;handleUpdate&quot;</span><br><span class="line">        v-hasPermi=&quot;[&#x27;system:user:edit&#x27;]&quot;</span><br><span class="line">      &gt;修改&lt;/el-button&gt;</span><br><span class="line">    &lt;/el-col&gt;</span><br><span class="line">     &lt;el-col :span=&quot;1.5&quot;&gt;</span><br><span class="line">      &lt;el-button</span><br><span class="line">        type=&quot;danger&quot;</span><br><span class="line">        plain</span><br><span class="line">        icon=&quot;el-icon-delete&quot;</span><br><span class="line">        size=&quot;mini&quot;</span><br><span class="line">        :disabled=&quot;multiple&quot;</span><br><span class="line">        @click=&quot;handleDelete&quot;</span><br><span class="line">        v-hasPermi=&quot;[&#x27;system:user:remove&#x27;]&quot;</span><br><span class="line">      &gt;删除&lt;/el-button&gt;</span><br><span class="line">    &lt;/el-col&gt;</span><br><span class="line">    &lt;el-col :span=&quot;1.5&quot;&gt;</span><br><span class="line">      &lt;el-button</span><br><span class="line">        type=&quot;info&quot;</span><br><span class="line">        plain</span><br><span class="line">        icon=&quot;el-icon-upload2&quot;</span><br><span class="line">        size=&quot;mini&quot;</span><br><span class="line">        @click=&quot;handleImport&quot;</span><br><span class="line">        v-hasPermi=&quot;[&#x27;system:user:import&#x27;]&quot;</span><br><span class="line">      &gt;导入&lt;/el-button&gt;</span><br><span class="line">    &lt;/el-col&gt;</span><br><span class="line">    &lt;el-col :span=&quot;1.5&quot;&gt;</span><br><span class="line">      &lt;el-button</span><br><span class="line">        type=&quot;warning&quot;</span><br><span class="line">        plain</span><br><span class="line">        icon=&quot;el-icon-download&quot;</span><br><span class="line">        size=&quot;mini&quot;</span><br><span class="line">        @click=&quot;handleExport&quot;</span><br><span class="line">        v-hasPermi=&quot;[&#x27;system:user:export&#x27;]&quot;</span><br><span class="line">      &gt;导出&lt;/el-button&gt;</span><br><span class="line">    &lt;/el-col&gt;</span><br><span class="line">    &lt;right-toolbar :showSearch.sync=&quot;showSearch&quot; @queryTable=&quot;getList&quot; :columns=&quot;columns&quot;&gt;&lt;/right-toolbar&gt;</span><br><span class="line">  &lt;/el-row&gt;</span><br></pre></td></tr></table></figure>

<p>很多按钮都有<code>v-hasPermi=&quot;[&#39;xxx:xxx:xxx&#39;]&quot;</code>，<code>v-hasPermi</code>是<code>vue</code>的自定义指令，属性值就是创建按钮时定义的权限标志。</p>
<p>其定义在<code>ruoyi-ui/src/directive/permission/hasPermi.js</code>文件中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * v-hasPermi 操作权限处理</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2019 ruoyi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">inserted</span>(<span class="params">el, binding, vnode</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; value &#125; = binding</span><br><span class="line">    <span class="keyword">const</span> all_permission = <span class="string">&quot;*:*:*&quot;</span>;</span><br><span class="line">    <span class="keyword">const</span> permissions = store.<span class="property">getters</span> &amp;&amp; store.<span class="property">getters</span>.<span class="property">permissions</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (value &amp;&amp; value <span class="keyword">instanceof</span> <span class="title class_">Array</span> &amp;&amp; value.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> permissionFlag = value</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> hasPermissions = permissions.<span class="title function_">some</span>(<span class="function"><span class="params">permission</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> all_permission === permission || permissionFlag.<span class="title function_">includes</span>(permission)</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!hasPermissions) &#123;</span><br><span class="line">        el.<span class="property">parentNode</span> &amp;&amp; el.<span class="property">parentNode</span>.<span class="title function_">removeChild</span>(el)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`请设置操作权限标签值`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="8-2-后端"><a href="#8-2-后端" class="headerlink" title="8.2 后端"></a>8.2 后端</h4><h5 id="8-2-1-接口权限"><a href="#8-2-1-接口权限" class="headerlink" title="8.2.1 接口权限"></a>8.2.1 接口权限</h5><p>在<code>controller</code>中随便找一个接口为例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取菜单列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;@ss.hasPermi(&#x27;system:menu:list&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">list</span><span class="params">(SysMenu menu)</span></span><br><span class="line">&#123;</span><br><span class="line">    List&lt;SysMenu&gt; menus = menuService.selectMenuList(menu, getUserId());</span><br><span class="line">    <span class="keyword">return</span> success(menus);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>发现其中有这样一行代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PreAuthorize(&quot;@ss.hasPermi(&#x27;system:menu:list&#x27;)&quot;)</span></span><br></pre></td></tr></table></figure>

<p>进入<code>hasPermi</code>方法，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 路径：ruoyi-framework/src/main/java/com/ruoyi/framework/web/service/PermissionService.java */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 验证用户是否具备某权限</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> permission 权限字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 用户是否具备某权限</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasPermi</span><span class="params">(String permission)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isEmpty(permission))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">LoginUser</span> <span class="variable">loginUser</span> <span class="operator">=</span> SecurityUtils.getLoginUser();</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isNull(loginUser) || CollectionUtils.isEmpty(loginUser.getPermissions()))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    PermissionContextHolder.setContext(permission);</span><br><span class="line">    <span class="keyword">return</span> hasPermissions(loginUser.getPermissions(), permission);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面代码逻辑如下：</p>
<ol>
<li>通过<code>SecurityUtils</code>工具类从<code>Security</code>上下文中获取到登录用户信息</li>
<li>然后从用户信息中获取到该用户所拥有的权限字符串集合</li>
<li>然后做对比，看其中是否包含【@ss.hasPermi(‘system:menu:list’)】中的权限字符串</li>
<li>包含就可以访问该方法，不包含就不可以访问该方法</li>
</ol>
<h3 id="权限方法"><a href="#权限方法" class="headerlink" title="权限方法"></a>权限方法</h3><p><code>@PreAuthorize</code>注解用于配置接口要求用户拥有某些权限才可访问，它拥有如下方法</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>hasPermi</td>
<td>String</td>
<td>验证用户是否具备某权限</td>
</tr>
<tr>
<td>lacksPermi</td>
<td>String</td>
<td>验证用户是否不具备某权限，与 hasPermi逻辑相反</td>
</tr>
<tr>
<td>hasAnyPermi</td>
<td>String</td>
<td>验证用户是否具有以下任意一个权限</td>
</tr>
<tr>
<td>hasRole</td>
<td>String</td>
<td>判断用户是否拥有某个角色</td>
</tr>
<tr>
<td>lacksRole</td>
<td>String</td>
<td>验证用户是否不具备某角色，与 isRole逻辑相反</td>
</tr>
<tr>
<td>hasAnyRoles</td>
<td>String</td>
<td>验证用户是否具有以下任意一个角色，多个逗号分隔</td>
</tr>
</tbody></table>
<p><a target="_blank" rel="noopener" href="https://doc.ruoyi.vip/ruoyi-vue/document/htsc.html#%E6%9D%83%E9%99%90%E6%B3%A8%E8%A7%A3">详细信息</a></p>
<h5 id="8-2-1-数据权限"><a href="#8-2-1-数据权限" class="headerlink" title="8.2.1 数据权限"></a>8.2.1 数据权限</h5><p><a target="_blank" rel="noopener" href="https://doc.ruoyi.vip/ruoyi/document/htsc.html#%E6%95%B0%E6%8D%AE%E6%9D%83%E9%99%90">文档内容</a></p>
<h2 id="9-项目实战"><a href="#9-项目实战" class="headerlink" title="9. 项目实战"></a>9. 项目实战</h2><p><strong>项目背景和需求说明</strong></p>
<p>学生成绩管理系统</p>
<ul>
<li><p>对学校的【课程信息】和【分数信息】进行管理</p>
</li>
<li><p>老师角色的人登录系统后，可以对【课程信息】和【分数信息】进行维护，进行增删改查</p>
</li>
<li><p>学生角色的人登录系统后，可以查看【课程信息】和【分数信息】，但是不能进行修改和删除操作就这么一个简单的需求，接下来，我们看看利用若依框架，如何快速的进行开发</p>
</li>
</ul>
<p><strong>项目表结构分析</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `t_score`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `t_score` (</span><br><span class="line">	`id` <span class="type">BIGINT</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键ID&#x27;</span>,</span><br><span class="line">	`create_time` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">	`create_user_name` <span class="type">VARCHAR</span>(<span class="number">10</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建人姓名&#x27;</span>,</span><br><span class="line">	`course_id` <span class="type">BIGINT</span>(<span class="number">2</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;课程ID&#x27;</span>,</span><br><span class="line">	`user_id` <span class="type">BIGINT</span>(<span class="number">1</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户ID&#x27;</span>,</span><br><span class="line">	`score` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;分数&#x27;</span>,</span><br><span class="line">	<span class="keyword">PRIMARY</span> key(`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">)ENGINE <span class="operator">=</span> INNODB AUTO_INCREMENT <span class="operator">=</span> <span class="number">1</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8mb4 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8mb4_general_ci COMMENT <span class="operator">=</span> <span class="string">&#x27;分数表&#x27;</span> ROW_FORMAT <span class="operator">=</span> Compact;</span><br><span class="line"></span><br><span class="line"><span class="comment">---------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `t_course`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `t_course` (</span><br><span class="line">	`id` <span class="type">BIGINT</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键ID&#x27;</span>,</span><br><span class="line">	`create_time` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">	`create_user_name` <span class="type">VARCHAR</span>(<span class="number">10</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建人姓名&#x27;</span>,</span><br><span class="line">	`course_name` <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;课程名称&#x27;</span>,</span><br><span class="line">	`course_status` <span class="type">INT</span>(<span class="number">1</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;课程状态（1:不可用；2:可用）&#x27;</span>,</span><br><span class="line">	<span class="keyword">PRIMARY</span> key(`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">)ENGINE <span class="operator">=</span> INNODB AUTO_INCREMENT <span class="operator">=</span> <span class="number">1</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8mb4 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8mb4_general_ci COMMENT <span class="operator">=</span> <span class="string">&#x27;课程表&#x27;</span> ROW_FORMAT <span class="operator">=</span> Compact;</span><br></pre></td></tr></table></figure>

<p><strong>代码生成</strong></p>
<img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/image-20240123143822327.png" alt="image-20240123143822327" style="zoom:50%;" />



<p>选择 “生成代码” 按钮，即可下载生成好的代码。</p>
<p><strong>拷贝代码到项目中并测试</strong></p>
<p>① 后端代码 - <code>位置：main/java</code></p>
<p>分为四个文件夹<code>controller</code>、<code>domain</code>、<code>mapper</code>、<code>service</code></p>
<ol>
<li><p><code>domain</code>实体类，拷贝放置位置<code>ruoyi-system/src/main/java/com/ruoyi/system/domain</code></p>
</li>
<li><p><code>mapper</code>，拷贝放置位置<code>ruoyi-system/src/main/java/com/ruoyi/system/mapper</code></p>
</li>
<li><p><code>service</code>，拷贝放置位置<code>ruoyi-system/src/main/java/com/ruoyi/system/service</code></p>
</li>
<li><p><code>mapper.xml</code>，拷贝放置位置<code>ruoyi-system/src/main/resources/mapper/system</code></p>
</li>
<li><p><code>controller</code>，拷贝放置位置<code>ruoyi-admin/src/main/java/com/ruoyi/web/controller/system</code></p>
</li>
</ol>
<p>② 前端代码 - <code>位置：vue</code></p>
<p>分为两个文件夹<code>api</code>、<code>views</code></p>
<ol>
<li><code>api下的js文件</code>，拷贝放置位置<code>RUOYI-UI/src/api/system</code></li>
<li><code>views下的vue文件</code>，拷贝放置位置<code>RUOYI-UI/src/views/system</code>，一般需要带着文件夹，例如<code>hourdb/index.vue</code></li>
</ol>
<p>③ 执行sql文件，完成菜单生成</p>
<p>在<code>ry-vue</code>下执行即可，执行完成后，可在<code>sys_menu</code>下查看生成的菜单数据</p>
<p>④ 执行maven - compile</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">qinwei</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://qw-null.github.io/2024/02/19/若依框架学习笔记/">https://qw-null.github.io/2024/02/19/若依框架学习笔记/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://qw-null.github.io">QW's Blog</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/">java</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2024/06/05/%E6%95%B0%E6%8D%AE%E6%B2%BB%E7%90%86%E6%8A%80%E6%9C%AF%E8%B0%83%E7%A0%94/"><i class="fa fa-chevron-left">  </i><span>数据治理技术调研</span></a></div><div class="next-post pull-right"><a href="/2024/01/18/Docker%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span>Docker学习笔记</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '44447f6848cb1055dfc7',
  clientSecret: '62722601a7b62e7a2f93add8216a30d9f047a2eb',
  repo: 'CommentData',
  owner: 'qw-null',
  admin: 'qw-null',
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN'
})
gitalk.render('gitalk-container')</script></div></div><footer class="footer-bg" style="background-image: url(https://cdn.jsdelivr.net/gh/qw-null/BlogImages/223.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2021 - 2024 By qinwei</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.1"></script><script src="/js/fancybox.js?version=1.9.1"></script><script src="/js/sidebar.js?version=1.9.1"></script><script src="/js/copy.js?version=1.9.1"></script><script src="/js/fireworks.js?version=1.9.1"></script><script src="/js/transition.js?version=1.9.1"></script><script src="/js/scroll.js?version=1.9.1"></script><script src="/js/head.js?version=1.9.1"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>