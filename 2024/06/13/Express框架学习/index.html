<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Express框架学习"><meta name="keywords" content="NodeJS"><meta name="author" content="qinwei"><meta name="copyright" content="qinwei"><title>Express框架学习 | QW's Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '5.4.2'
} </script><meta name="generator" content="Hexo 5.4.2"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BAExpress%E9%A1%B9%E7%9B%AE"><span class="toc-text">1.创建Express项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-nodemon%E7%9B%91%E5%90%AC%E4%BF%AE%E6%94%B9"><span class="toc-text">2.nodemon监听修改</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-text">3.项目结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E4%BD%BF%E7%94%A8-Docker-%E8%BF%90%E8%A1%8C-MySQL"><span class="toc-text">4.使用 Docker 运行 MySQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Sequelize-ORM"><span class="toc-text">5.Sequelize ORM</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-Sequelize-ORM-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">5.1 Sequelize ORM 的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2%E5%88%9B%E5%BB%BA%E6%A8%A1%E5%9E%8B"><span class="toc-text">5.2创建模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3%E8%BF%81%E7%A7%BB%E6%96%87%E4%BB%B6"><span class="toc-text">5.3迁移文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E7%A7%8D%E5%AD%90%E6%96%87%E4%BB%B6"><span class="toc-text">5.4 种子文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-CRDU%E6%8E%A5%E5%8F%A3"><span class="toc-text">6.CRDU接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E5%A4%84%E7%90%86%E8%B7%AF%E7%94%B1%E6%96%87%E4%BB%B6"><span class="toc-text">6.1 处理路由文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-app-js"><span class="toc-text">6.2 app.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3%E5%A4%84%E7%90%86%E6%8E%A5%E5%8F%A3%E8%BF%94%E5%9B%9E%E4%BF%A1%E6%81%AF"><span class="toc-text">6.3处理接口返回信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-%E6%8E%A5%E5%8F%A3"><span class="toc-text">6.4 接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E4%BC%81%E4%B8%9A%E5%86%85%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E7%9A%84%E6%B5%81%E7%A8%8B"><span class="toc-text">7.企业内项目开发的流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%BB%BA%E7%AB%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8"><span class="toc-text">8.建立数据库表</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/20211013182113.JPG"></div><div class="author-info__name text-center">qinwei</div><div class="author-info__description text-center"></div><div class="follow-button"><a target="_blank" rel="noopener" href="https://github.com/qw-null">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">158</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">46</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">30</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/qw-null/BlogImages/223.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">QW's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">首页</a><a class="site-page" href="/categories">分类</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/archives">创作时间线</a><a class="site-page" target="_blank" rel="noopener" href="https://github.com/qw-null">Github</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">Express框架学习</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2024-06-13</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%90%8E%E7%AB%AF%E5%AD%A6%E4%B9%A0/">后端学习</a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">3.4k</span><span class="post-meta__separator">|</span><span>阅读时长: 13 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="1-创建Express项目"><a href="#1-创建Express项目" class="headerlink" title="1.创建Express项目"></a>1.创建Express项目</h2><p>创建<code>express</code>项目可以通过使用<code>express-generator</code>脚手架，通过它，一个命令就会自动生成项目所需要的结构了。<br>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">npm i -g express-generator@4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建项目（到指定文件夹下）</span></span><br><span class="line">express --no-view 项目名称</span><br></pre></td></tr></table></figure><br><code>--no-view</code>参数的意思是不需要任何视图模板，适用于专门做后端接口的项目创建。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装依赖</span></span><br><span class="line">npm i</span><br><span class="line"><span class="comment"># 运行</span></span><br><span class="line">npm start</span><br></pre></td></tr></table></figure>
<p>现在就可以通过 <code>http://localhost:3000</code>，来访问项目了。</p>
<blockquote>
<p>现在对项目中的内容每次修改之后，都需要重启项目来查看，那么是否有更好的方式能够实现热修改呢？</p>
</blockquote>
<h2 id="2-nodemon监听修改"><a href="#2-nodemon监听修改" class="headerlink" title="2.nodemon监听修改"></a>2.nodemon监听修改</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">npm i nodemon</span><br></pre></td></tr></table></figure>
<p>然后打开项目根目录下的<code>package.json</code>，将<code>start</code>这里修改为</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nodemon ./bin/www&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>
<p>再次重启服务即可使用</p>
<h2 id="3-项目结构"><a href="#3-项目结构" class="headerlink" title="3.项目结构"></a>3.项目结构</h2><p><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202406131042072.png"></p>
<ul>
<li><code>bin/www</code>：在<code>package.json</code>中，大家见过这个文件的配置。它是用来启动项目的文件，无需修改，也不用管它，知道它是干嘛的就好了。</li>
<li><code>public 目录</code>：这里放的各种静态资源，例如 CSS、图片等等静态资源。但因为我们项目是专门开发接口的，所以这里的东西，大家完全不需要管它，根本用不上。</li>
<li><code>routes</code>：程序的路由部分，路由简单的理解就是将不同网址分别对应到不同的程序代码上去。</li>
<li><code>app.js</code>：这个文件也很重要，在开发中，我们需要做一些路由的配置、跨域配置，都会来修改它的。</li>
</ul>
<h2 id="4-使用-Docker-运行-MySQL"><a href="#4-使用-Docker-运行-MySQL" class="headerlink" title="4.使用 Docker 运行 MySQL"></a>4.使用 Docker 运行 MySQL</h2><p><strong>docker compose</strong><br>在项目根目录中，新建一个文件，叫做docker-compose.yml。千万要注意，一定要在项目根目录中，放在其他地方会找不到的。然后将下面的配置复制进去，这就是MySQL的一个简单配置了。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:8.3.0</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="string">--default-authentication-plugin=mysql_native_password</span></span><br><span class="line">      <span class="string">--character-set-server=utf8mb4</span></span><br><span class="line">      <span class="string">--collation-server=utf8mb4_general_ci</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_ROOT_PASSWORD=MySQL的密码</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_LOWER_CASE_TABLE_NAMES=0</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3307:3306&quot;</span> <span class="comment"># 端口映射：本机端口:容器端口</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data/mysql:/var/lib/mysql</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>运行<code>docker-compose up -d</code>下载mysql，完成后到Docker中启动数据库服务，在本机可以通过<code>Navicat</code>，<code>http://localhost:3307</code>进行访问。</p>
<h2 id="5-Sequelize-ORM"><a href="#5-Sequelize-ORM" class="headerlink" title="5.Sequelize ORM"></a>5.Sequelize ORM</h2><p>Sequelize 是一个用于 Node.js 的流行的对象关系映射（ORM）库。</p>
<p>它主要有以下特点和作用：</p>
<ul>
<li><strong>简化数据库操作</strong>：通过将数据库表和操作映射到 JavaScript 对象和方法，使开发者可以使用面向对象的方式与数据库进行交互，而无需直接编写复杂的 SQL 语句。</li>
<li><strong>提供模型定义</strong>：可以方便地定义数据库中的模型（表结构），包括字段、关系等。</li>
<li><strong>数据操作接口</strong>：提供了诸如创建、读取、更新、删除（CRUD）等操作的方法，以及处理关联模型的能力。</li>
<li><strong>数据库连接管理</strong>：帮助管理与数据库的连接和相关配置。</li>
<li><strong>可移植性</strong>：使得应用在不同的数据库系统（如 MySQL、PostgreSQL、SQLite 等）之间切换相对容易，只需更改少量配置。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202406131105775.png"></p>
<h3 id="5-1-Sequelize-ORM-的使用"><a href="#5-1-Sequelize-ORM-的使用" class="headerlink" title="5.1 Sequelize ORM 的使用"></a>5.1 Sequelize ORM 的使用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">npm i -g sequelize-cli</span><br></pre></td></tr></table></figure>
<p>在当前项目目录下安装所依赖的sequelize包和对数据库支持依赖的mysql2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i sequelize mysql2</span><br></pre></td></tr></table></figure>
<p>初始化项目</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sequelize init</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202406131115578.png"><br>可以看到，提示我们，创建了一个config配置文件和三个目录，这些就是sequelize所需要的东西了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── config</span><br><span class="line">│   └── config.json</span><br><span class="line">├── migrations</span><br><span class="line">├── models</span><br><span class="line">│   └── index.js</span><br><span class="line">└── seeders</span><br></pre></td></tr></table></figure>
<ul>
<li>config.json：sequelize连接数据库的配置文件，配置数据库连接需要的相关信息</li>
<li>migrations：是迁移的意思，如果你需要对数据库做新增表、修改字段、删除表等等操作，就需要在这里添加迁移文件了。而不是像以前那样，使用客户端软件来直接操作数据库。</li>
<li>models：这里面存放的是模型文件，当我们使用sequelize来执行增删改查时，就需要用这里的模型文件了。每个模型都对应数据库中的一张表。</li>
<li>seeders，是存放的种子文件。一般会将一些需要添加到数据表的测试数据存在这里。只需要运行一个命令，数据表中就会自动填充进一些用来测试内容的了。</li>
</ul>
<p><code>config.json</code>文件的内容如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;development&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;root&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;clwy1234&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;database&quot;</span><span class="punctuation">:</span> <span class="string">&quot;clwy_api_development&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dialect&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mysql&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;timezone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;+08:00&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;root&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;database&quot;</span><span class="punctuation">:</span> <span class="string">&quot;clwy_api_test&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dialect&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mysql&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;timezone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;+08:00&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;production&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;root&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;database&quot;</span><span class="punctuation">:</span> <span class="string">&quot;clwy_api_production&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dialect&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mysql&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;timezone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;+08:00&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="5-2创建模型"><a href="#5-2创建模型" class="headerlink" title="5.2创建模型"></a>5.2创建模型</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sequelize model:generate --name Article --attributes title:string,content:text</span><br></pre></td></tr></table></figure>
<p>打开<code>models/article.js</code>。可以看到，在模型文件夹中，出现了一个叫做<code>Article</code>的模型，它里面有标题和内容。</p>
<p>标题是字符串类型，对应到 <code>MySQL</code> 数据库里，它就会自动变成<code>varchar</code>。内容部分，则是<code>text</code>类型。</p>
<h3 id="5-3迁移文件"><a href="#5-3迁移文件" class="headerlink" title="5.3迁移文件"></a>5.3迁移文件</h3><p>在<code>migrations</code>文件夹，里面出现了一个由当前时间，加上<code>create-article</code>命名的文件，这个文件就是迁移文件了。<i style="color:red;">它的作用就是用来创建、修改表的。</i></p>
<p>看到这里，在up部分。我们通过createTabel，创建了一个叫做Articles的表。</p>
<p><i style="color:red;">大家注意哦，这就是我之前和大家说的，模型名字是单数：Article。但是表的名字一定是复数形式，也就是Articles。</i>这是sequelize里的命名规则，一定不要搞错了。如果你的单复数搞错了，那sequelize就找不到对应的东西了。</p>
<p>接着往下看，这些就是定义了Articles这张表里面所拥有的字段了，比方说id、title、content，这些外还出现了两个时间字段createdAt和updatedAt。</p>
<p>这两个字段，当在新增或修改数据的时候，sequelize会自动的帮我们填写的。</p>
<p>这里的内容，已经非常好了，我们只需要做一个小小的调整。就是title部分，我需要它不为null，所以加上allowNull: false,。content部分，我们就不管它了，已经很好了。</p>
<p>至于down部分，是新建表的反向操作，里面写的是dropTable，也就是删除当前的表。这样当我们创建表，建完后，突然又发现有错误，也可以通过相关命令来删除当前表。</p>
<p>运行迁移文件：<code>sequelize db:migrate</code></p>
<p>打开数据库客户端，刷新一下，可以看到Articles表又神奇的出现了。看一看结构选项卡，里面的字段和我们当时自己手动创建的完全一样，而且还多了两个时间字段。这就是迁移文件的作用了。</p>
<h3 id="5-4-种子文件"><a href="#5-4-种子文件" class="headerlink" title="5.4 种子文件"></a>5.4 种子文件</h3><p>现在表也有了，下一步就是要填充一些在开发中用来测试的数据了。当然你可以用手动往里面一点点填，但很多情况我们做测试，可能需要非常多的数据。例如我希望数据库里有 100 篇文章，这时候，我们一条条的录入也太笨了点。最简单的方法就是使用种子文件了。再来试试这条命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sequelize seed:generate --name article</span><br></pre></td></tr></table></figure>
<p>完成后，在<code>seeds</code>目录，就看到刚才命令新建的种子文件了。同样也是分为两个部分，<code>up</code>部分用来填充数据，<code>down</code>部分是反向操作，用来删除数据的。</p>
<p>通过<code>up</code>方法往<code>Articles</code>表里插入数据。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">up</span> (queryInterface, <span class="title class_">Sequelize</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> articles = [];</span><br><span class="line">  <span class="keyword">const</span> counts = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= counts; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> article = &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">`文章的标题 <span class="subst">$&#123;i&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">content</span>: <span class="string">`文章的内容 <span class="subst">$&#123;i&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">createdAt</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(),</span><br><span class="line">      <span class="attr">updatedAt</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    articles.<span class="title function_">push</span>(article);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> queryInterface.<span class="title function_">bulkInsert</span>(<span class="string">&#x27;Articles&#x27;</span>, articles, &#123;&#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p><code>down</code>部分进行修改</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">down</span> (queryInterface, <span class="title class_">Sequelize</span>) &#123;</span><br><span class="line">  <span class="keyword">await</span> queryInterface.<span class="title function_">bulkDelete</span>(<span class="string">&#x27;Articles&#x27;</span>, <span class="literal">null</span>, &#123;&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行种子文件，往数据库中插入数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sequelize db:seed --seed seeds目录下的js文件名字（如xxx-article）</span><br></pre></td></tr></table></figure>

<h2 id="6-CRDU接口"><a href="#6-CRDU接口" class="headerlink" title="6.CRDU接口"></a>6.CRDU接口</h2><h3 id="6-1-处理路由文件"><a href="#6-1-处理路由文件" class="headerlink" title="6.1 处理路由文件"></a>6.1 处理路由文件</h3><p>项目的路由文件存放在<code>routes</code>文件夹下，对于每一类待写的接口，都要在<code>routes</code>文件夹下创建新的js文件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page. */</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>, <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">json</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;Hello express1.0&quot;</span> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>
<h3 id="6-2-app-js"><a href="#6-2-app-js" class="headerlink" title="6.2 app.js"></a>6.2 app.js</h3><p>在<code>app.js</code>文件中引入创建的路由文件。<br>例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> articlesRouter = <span class="built_in">require</span>(<span class="string">&quot;./routes/admin/articles&quot;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/admin/articles&quot;</span>, articlesRouter);</span><br></pre></td></tr></table></figure>
<p>其中，<code>/admin/articles</code>就是新创建的路由的地址。例如：<code>http://localhost:3000/admin/articles</code>可以访问其中的接口。</p>
<h3 id="6-3处理接口返回信息"><a href="#6-3处理接口返回信息" class="headerlink" title="6.3处理接口返回信息"></a>6.3处理接口返回信息</h3><p>对于接口返回信息而言，分为请求成功和请求失败两种情况。对于这两种情况，一般需要返回状态码、数据、信息等，因此可以将其抽取出来封装成为公共方法。<br>一般将这类方法存在根目录下的<code>utils</code>文件夹中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// response.js 文件</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义 404 错误类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NotFoundError</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Error</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">message</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(message);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&quot;NotFoundError&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">success</span>(<span class="params">res, message, data = &#123;&#125;, code = <span class="number">200</span></span>) &#123;</span><br><span class="line">  res.<span class="title function_">status</span>(code).<span class="title function_">json</span>(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="literal">true</span>,</span><br><span class="line">    message,</span><br><span class="line">    data,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">failure</span>(<span class="params">res, error</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (error.<span class="property">name</span> === <span class="string">&quot;SequelizeValidationError&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> errors = error.<span class="property">errors</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> e.<span class="property">message</span>);</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">status</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&quot;请求参数错误&quot;</span>,</span><br><span class="line">      errors,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (error.<span class="property">name</span> === <span class="string">&quot;NotFoundError&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">404</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">status</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&quot;资源不存在&quot;</span>,</span><br><span class="line">      <span class="attr">errors</span>: [error.<span class="property">message</span>],</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&quot;服务器错误&quot;</span>,</span><br><span class="line">    <span class="attr">errors</span>: [error.<span class="property">message</span>],</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="title class_">NotFoundError</span>,</span><br><span class="line">  success,</span><br><span class="line">  failure,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="6-4-接口"><a href="#6-4-接口" class="headerlink" title="6.4 接口"></a>6.4 接口</h3><p>对于接口方法中的通用功能，可以将其抽取成为一个公共方法。<br>例如，根据id号查询具体文章方法在多个借口中都会使用到。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 公共方法：查询当前文章</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getArticle</span>(<span class="params">req</span>) &#123;</span><br><span class="line">  <span class="comment">// 获取文章id</span></span><br><span class="line">  <span class="keyword">const</span> &#123; id &#125; = req.<span class="property">params</span>;</span><br><span class="line">  <span class="comment">// 查询当前文章</span></span><br><span class="line">  <span class="keyword">const</span> article = <span class="keyword">await</span> <span class="title class_">Article</span>.<span class="title function_">findByPk</span>(id);</span><br><span class="line">  <span class="keyword">if</span> (!article) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NotFoundError</span>(<span class="string">`ID:<span class="subst">$&#123;id&#125;</span>的文章未找到`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> article;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 白名单过滤（强参数过滤）：保证只使用到用户传递过来具体的字段，防止用户传递有害信息</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">filterBody</span>(<span class="params">req</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">title</span>: req.<span class="property">body</span>.<span class="property">title</span>,</span><br><span class="line">    <span class="attr">content</span>: req.<span class="property">body</span>.<span class="property">content</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 增：创建文章接口</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/&quot;</span>, <span class="title function_">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> body = <span class="title function_">filterBody</span>(req);</span><br><span class="line">    <span class="keyword">const</span> article = <span class="keyword">await</span> <span class="title class_">Article</span>.<span class="title function_">create</span>(body);</span><br><span class="line">    <span class="title function_">success</span>(res, <span class="string">&quot;创建文章成功&quot;</span>, &#123; article &#125;, <span class="number">201</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="title function_">failure</span>(res, error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删：删除文章接口</span></span><br><span class="line">router.<span class="title function_">delete</span>(<span class="string">&quot;/:id&quot;</span>, <span class="title function_">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> article = <span class="keyword">await</span> <span class="title function_">getArticle</span>(req);</span><br><span class="line">    <span class="keyword">await</span> article.<span class="title function_">destroy</span>();</span><br><span class="line">    <span class="title function_">success</span>(res, <span class="string">&quot;删除文章成功&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="title function_">failure</span>(res, error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 改：更新文章接口</span></span><br><span class="line">router.<span class="title function_">put</span>(<span class="string">&quot;/:id&quot;</span>, <span class="title function_">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> article = <span class="keyword">await</span> <span class="title function_">getArticle</span>(req);</span><br><span class="line">    <span class="keyword">const</span> body = <span class="title function_">filterBody</span>(req);</span><br><span class="line">    <span class="keyword">await</span> article.<span class="title function_">update</span>(body);</span><br><span class="line">    <span class="title function_">success</span>(res, <span class="string">&quot;更新文章成功&quot;</span>, &#123; article &#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="title function_">failure</span>(res, err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查：查询文章数据</span></span><br><span class="line"><span class="comment">// 1.查询文章列表（分页 &amp; 条件搜索）</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>, <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> query = req.<span class="property">query</span>;</span><br><span class="line">    <span class="keyword">const</span> condition = &#123;</span><br><span class="line">      <span class="attr">order</span>: [[<span class="string">&quot;id&quot;</span>, <span class="string">&quot;DESC&quot;</span>]],</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span> (query.<span class="property">title</span>) &#123;</span><br><span class="line">      <span class="comment">// 通过Op的方式实现模糊查询</span></span><br><span class="line">      condition.<span class="property">where</span> = &#123;</span><br><span class="line">        <span class="attr">title</span>: &#123;</span><br><span class="line">          [<span class="title class_">Op</span>.<span class="property">like</span>]: <span class="string">`%<span class="subst">$&#123;query.title&#125;</span>%`</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 数据分页</span></span><br><span class="line">    <span class="comment">// 当前是第几页，如果不传，那就是第一页</span></span><br><span class="line">    <span class="keyword">const</span> currentPage = <span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="title class_">Number</span>(query.<span class="property">currentPage</span>)) || <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// 每页显示多少条信息，如果不传，就显示10条信息</span></span><br><span class="line">    <span class="keyword">const</span> pageSize = <span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="title class_">Number</span>(query.<span class="property">pageSize</span>)) || <span class="number">10</span>;</span><br><span class="line">    <span class="comment">// 计算offset</span></span><br><span class="line">    <span class="keyword">const</span> offset = (currentPage - <span class="number">1</span>) * pageSize;</span><br><span class="line">    condition.<span class="property">limit</span> = pageSize;</span><br><span class="line">    condition.<span class="property">offset</span> = offset;</span><br><span class="line">    <span class="comment">// const articles = await Article.findAll(condition);</span></span><br><span class="line">    <span class="comment">// 分页更换查询函数findAndCountAll，rows是查询到的数据，count是数据总条数</span></span><br><span class="line">    <span class="keyword">const</span> &#123; count, rows &#125; = <span class="keyword">await</span> <span class="title class_">Article</span>.<span class="title function_">findAndCountAll</span>(condition);</span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line">        <span class="attr">articles</span>: rows,</span><br><span class="line">        <span class="attr">pagination</span>: &#123;</span><br><span class="line">          <span class="attr">total</span>: count,</span><br><span class="line">          currentPage,</span><br><span class="line">          pageSize,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="title function_">success</span>(res,<span class="string">&quot;查询文章列表成功&quot;</span>,data);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="title function_">failure</span>(res, err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="7-企业内项目开发的流程"><a href="#7-企业内项目开发的流程" class="headerlink" title="7.企业内项目开发的流程"></a>7.企业内项目开发的流程</h2><ol>
<li>编写需求文档</li>
<li>原型与UI设计</li>
<li>确定数据库的表、字段以及接口地址和数据</li>
<li>同时进行：前端mock开发、后端接口开发</li>
<li>接口开发完成后，将mock地址更换为接口地址</li>
<li>测试、上线部署</li>
</ol>
<h2 id="8-建立数据库表"><a href="#8-建立数据库表" class="headerlink" title="8.建立数据库表"></a>8.建立数据库表</h2><p>回滚迁移：<code>sequelize db:migrate:undo</code>，运行命令后，会回滚上一次运行的迁移，也就是删掉<code>Article</code>表。<br>以创建<code>Courses</code>表为例：</p>
<ol>
<li>运行创建命令：<code>sequelize model:generate --name Course --attributes categoryId:integer,userId:integer,name:string,image:string,recommended:boolean,introductory:boolean,content:text,likesCount:integer,chaptersCount:integer</code></li>
<li>修改<code>migrations</code>文件夹下的对应<code>course</code>文件：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; toDefaultValue &#125; = <span class="built_in">require</span>(<span class="string">&quot;sequelize/lib/utils&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">import(&#x27;sequelize-cli&#x27;).Migration</span>&#125; */</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">up</span>(<span class="params">queryInterface, Sequelize</span>) &#123;</span><br><span class="line">    <span class="keyword">await</span> queryInterface.<span class="title function_">createTable</span>(<span class="string">&quot;Courses&quot;</span>, &#123;</span><br><span class="line">      <span class="attr">id</span>: &#123;</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">autoIncrement</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">primaryKey</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Sequelize</span>.<span class="property">INTEGER</span>.<span class="property">UNSIGNED</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">categoryId</span>: &#123;</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Sequelize</span>.<span class="property">INTEGER</span>.<span class="property">UNSIGNED</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">userId</span>: &#123;</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Sequelize</span>.<span class="property">INTEGER</span>.<span class="property">UNSIGNED</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">name</span>: &#123;</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Sequelize</span>.<span class="property">STRING</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">image</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Sequelize</span>.<span class="property">STRING</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">recommended</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Sequelize</span>.<span class="property">BOOLEAN</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">introductory</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Sequelize</span>.<span class="property">BOOLEAN</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">content</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Sequelize</span>.<span class="property">TEXT</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">likesCount</span>: &#123;</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Sequelize</span>.<span class="property">INTEGER</span>.<span class="property">UNSIGNED</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">chaptersCount</span>: &#123;</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Sequelize</span>.<span class="property">INTEGER</span>.<span class="property">UNSIGNED</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">createdAt</span>: &#123;</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Sequelize</span>.<span class="property">DATE</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">updatedAt</span>: &#123;</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Sequelize</span>.<span class="property">DATE</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">await</span> queryInterface.<span class="title function_">addIndex</span>(<span class="string">&quot;Courses&quot;</span>, &#123;</span><br><span class="line">      <span class="attr">fields</span>: [<span class="string">&quot;categoryId&quot;</span>],</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">await</span> queryInterface.<span class="title function_">addIndex</span>(<span class="string">&quot;Courses&quot;</span>, &#123;</span><br><span class="line">      <span class="attr">fields</span>: [<span class="string">&quot;userId&quot;</span>],</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">down</span>(<span class="params">queryInterface, Sequelize</span>) &#123;</span><br><span class="line">    <span class="keyword">await</span> queryInterface.<span class="title function_">dropTable</span>(<span class="string">&quot;Courses&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">qinwei</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://qw-null.github.io/2024/06/13/Express框架学习/">https://qw-null.github.io/2024/06/13/Express框架学习/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://qw-null.github.io">QW's Blog</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/NodeJS/">NodeJS</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2024/09/24/Linux%E7%8E%AF%E5%A2%83%E4%B8%8B%E9%85%8D%E7%BD%AEgit/"><i class="fa fa-chevron-left">  </i><span>Linux环境下配置git</span></a></div><div class="next-post pull-right"><a href="/2024/06/06/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E5%88%86%E5%8C%BA/"><span>MySQL数据库表分区</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '44447f6848cb1055dfc7',
  clientSecret: '62722601a7b62e7a2f93add8216a30d9f047a2eb',
  repo: 'CommentData',
  owner: 'qw-null',
  admin: 'qw-null',
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN'
})
gitalk.render('gitalk-container')</script></div></div><footer class="footer-bg" style="background-image: url(https://cdn.jsdelivr.net/gh/qw-null/BlogImages/223.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2021 - 2024 By qinwei</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.1"></script><script src="/js/fancybox.js?version=1.9.1"></script><script src="/js/sidebar.js?version=1.9.1"></script><script src="/js/copy.js?version=1.9.1"></script><script src="/js/fireworks.js?version=1.9.1"></script><script src="/js/transition.js?version=1.9.1"></script><script src="/js/scroll.js?version=1.9.1"></script><script src="/js/head.js?version=1.9.1"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>