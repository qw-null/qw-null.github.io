<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Web3.0 DeFi项目实战开发"><meta name="keywords" content="区块链,web3"><meta name="author" content="qinwei"><meta name="copyright" content="qinwei"><title>Web3.0 DeFi项目实战开发 | QW's Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '5.4.2'
} </script><meta name="generator" content="Hexo 5.4.2"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Web3-0-%E7%AE%80%E4%BB%8B"><span class="toc-text">Web3.0 简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%83%E5%AE%87%E5%AE%99"><span class="toc-text">元宇宙</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NFT"><span class="toc-text">NFT</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8C%BA%E5%9D%97%E9%93%BE"><span class="toc-text">区块链</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AF%94%E7%89%B9%E5%B8%81-%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8C%BA%E5%9D%97%E9%93%BE%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-text">比特币 - 第一个区块链的应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E5%9D%8A"><span class="toc-text">以太坊</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6"><span class="toc-text">智能合约</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91"><span class="toc-text">项目开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web3-%E8%BF%9E%E6%8E%A5%E5%88%B0%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%BD%91%E7%BB%9C%EF%BC%88%E6%B5%8B%E8%AF%95%E7%BD%91%E3%80%81%E4%B8%BB%E7%BD%91%EF%BC%89"><span class="toc-text">web3 连接到以太坊网络（测试网、主网）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF-web3"><span class="toc-text">1.什么是 web3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AE%9E%E4%BE%8B%E5%8C%96-web3"><span class="toc-text">2.实例化 web3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%8E%B7%E5%8F%96%E8%BF%9E%E6%8E%A5%E5%88%B0%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%BD%91%E7%BB%9C%E7%9A%84%E8%8A%82%E7%82%B9%E5%9C%B0%E5%9D%80"><span class="toc-text">3.获取连接到以太坊网络的节点地址</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web3-js-%E9%AB%98%E9%A2%91API"><span class="toc-text">web3.js 高频API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%B4%A6%E5%8F%B7%E5%88%9B%E5%BB%BA"><span class="toc-text">1.账号创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%8E%B7%E5%8F%96%E5%9C%B0%E5%9D%80"><span class="toc-text">2.获取地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%8E%B7%E5%8F%96%E7%A7%81%E9%92%A5"><span class="toc-text">3.获取私钥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%BD%99%E9%A2%9D%E8%8E%B7%E5%8F%96"><span class="toc-text">4.余额获取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%8D%95%E4%BD%8D%E8%BD%AC%E6%8D%A2"><span class="toc-text">5.单位转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-Eth%E8%BD%AC%E8%B4%A6-%E2%9A%A0%EF%B8%8F%E5%AD%98%E5%9C%A8%E9%97%AE%E9%A2%98"><span class="toc-text">6.Eth转账[⚠️存在问题]</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B4%A6%E6%88%B7%E7%B3%BB%E7%BB%9F"><span class="toc-text">账户系统</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%86%E7%A0%81"><span class="toc-text">密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A7%81%E9%92%A5-Private-Key"><span class="toc-text">私钥 Private Key</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AC%E9%92%A5-Public-Key"><span class="toc-text">公钥 Public Key</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Keystore"><span class="toc-text">Keystore</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A9%E8%AE%B0%E8%AF%8D-Mnemonic"><span class="toc-text">助记词 Mnemonic</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BIP"><span class="toc-text">BIP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HD%E9%92%B1%E5%8C%85"><span class="toc-text">HD钱包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E3%80%81%E7%A7%81%E9%92%A5%E3%80%81keystore%E4%B8%8E%E5%8A%A9%E8%AE%B0%E8%AF%8D%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-text">密码、私钥、keystore与助记词的关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%92%B1%E5%8C%85%E7%9A%84%E6%A0%B8%E5%BF%83%EF%BC%9A%E7%A7%81%E9%92%A5"><span class="toc-text">钱包的核心：私钥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E5%8A%A9%E8%AE%B0%E8%AF%8D-%E5%88%9B%E5%BB%BA%E8%B4%A6%E6%88%B7"><span class="toc-text">通过助记词 - 创建账户</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E8%B4%A6%E6%88%B7"><span class="toc-text">导出账户</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E8%B4%A6%E6%88%B7"><span class="toc-text">导入账户</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/20211013182113.JPG"></div><div class="author-info__name text-center">qinwei</div><div class="author-info__description text-center"></div><div class="follow-button"><a target="_blank" rel="noopener" href="https://github.com/qw-null">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">158</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">46</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">30</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/qw-null/BlogImages/223.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">QW's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">首页</a><a class="site-page" href="/categories">分类</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/archives">创作时间线</a><a class="site-page" target="_blank" rel="noopener" href="https://github.com/qw-null">Github</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">Web3.0 DeFi项目实战开发</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-12-19</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/">区块链</a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">5.3k</span><span class="post-meta__separator">|</span><span>阅读时长: 18 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV14A411178x/?share_source=copy_web&vd_source=f3ff8a2761a3e07339584c4852cdd504">视频地址</a></p>
<h1 id="Web3-0-简介"><a href="#Web3-0-简介" class="headerlink" title="Web3.0 简介"></a>Web3.0 简介</h1><ul>
<li>web1.0 时代：只能读，不能写，没有互动功能方法</li>
<li>web2.0 时代：可读可写，内容由全体网民产生，中心化（数据储存在服务器、易产生垄断）</li>
<li>web3.0 时代：去中心化（最大的特点）、web3.0 的基础是区块链技术（区块链技术是元宇宙等时髦概念的底层架构和逻辑基础）、数据掌握在生产者手中。</li>
</ul>
<p>web3.0 能够实现去中心化得益于区块链催生的智能合约技术，它不仅可以记录信息，还可以运行应用程序。</p>
<p>去中心化的应用 - DAPP</p>
<p>区块链支撑的 web3.0<br><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312191534592.png"></p>
<h1 id="元宇宙"><a href="#元宇宙" class="headerlink" title="元宇宙"></a>元宇宙</h1><p><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312191510341.png"></p>
<h1 id="NFT"><a href="#NFT" class="headerlink" title="NFT"></a>NFT</h1><p>NFT（Non-fungible token）非同质化代币、不可互换的代币<br>数字藏品</p>
<h1 id="区块链"><a href="#区块链" class="headerlink" title="区块链"></a>区块链</h1><p><a target="_blank" rel="noopener" href="https://github.com/anders94/blockchain-demo">区块链 Demo 地址</a></p>
<p><strong>定义</strong><br><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312191538680.png"></p>
<p><strong>特征</strong><br>去中心化、共识机制、不可篡改<br><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312191543547.png"></p>
<p><strong>应用场景</strong><br><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312191606112.png"></p>
<p><strong>类型</strong><br>公链、私链、联盟链、混合链<br><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312191607904.png"></p>
<p><strong>hash 算法</strong></p>
<ul>
<li>从 hash 值不可以反向推导出原始数据</li>
<li>输入数据的微小变化会得到完全不同的 hash 值</li>
<li>相同的数据会得到相同的值</li>
<li>执行效率高效，长的文本也能很快地计算出哈希值</li>
<li>hash 算法的冲突概率很小</li>
</ul>
<p><strong>区块的概念</strong><br><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312191623512.png"></p>
<p>第 n 块的 Hash 值 = Hash(第 n-1 块的 Hash 值+第 n 块的账本数据)</p>
<p><strong>P2P 网络</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312191630511.png"></p>
<p><strong>记账与挖矿</strong></p>
<p>为什么会有人愿意花费精力来记账？<br><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312191634252.png"><br><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312191635640.png"></p>
<p>以谁记录的账本为准？<br>比特币采取的是工作量证明法（POW），也就是让记账的人去解一道运算量很大的数学题，谁能够最先解出来，就用谁的账本，同时谁也就获得了比特币的奖励，这个解数学题的过程就叫做挖矿，所以挖矿比拼的就是矿机 CPU 的运算能力。</p>
<p><strong>共识机制</strong><br>广泛应用的共识机制：<br><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312191641728.png"></p>
<h2 id="比特币-第一个区块链的应用"><a href="#比特币-第一个区块链的应用" class="headerlink" title="比特币 - 第一个区块链的应用"></a>比特币 - 第一个区块链的应用</h2><p>比特币是区块链的一个应用。</p>
<h2 id="以太坊"><a href="#以太坊" class="headerlink" title="以太坊"></a>以太坊</h2><p>以太坊作为一种基于区块链技术的去中心化应用平台，与比特币仅支持货币交易不同，可以在以太坊上开发和运行去中心化的应用程序。以太坊背后的核心思想是开发人员可以在分布式网络中创建和运行程序代码，而不受中心化控制。以太坊使用以太币（Ether，代码为 ETH）作为交易货币。<br><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312201005448.png"></p>
<p>以太币干什么用？<br><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312201008445.png"></p>
<p>以太坊-区块链钱包：<br>钱包里存储的是数字资产的账户信息和密钥信息，而不是实际资产。<br>热钱包（HotWallet）、冷钱包（Cold Wallet），其中冷钱包是脱离网络连接的离线钱包，热钱包需要联网才能够使用。</p>
<p>钱包的概念：<br><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312201029737.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312201032861.png"><br>一组助记词可以产生很多账号</p>
<p><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312201116899.png"></p>
<h2 id="智能合约"><a href="#智能合约" class="headerlink" title="智能合约"></a>智能合约</h2><p>什么是智能合约？<br>智能合约是一种自动执行合约的协议，其中的条款和条件以计算机代码的形式编写。它们运行在区块链技术之上，如以太坊。智能合约允许在没有第三方的情况下进行可靠的交易和协议执行。</p>
<p>智能合约的主要特点包括：</p>
<ol>
<li><strong>自动执行</strong>：一旦设定条件被满足，合约就会自动执行。</li>
<li><strong>透明和不可篡改</strong>：所有的交易和操作都被记录在区块链上，任何人都可以查看，但无法更改。</li>
<li><strong>安全性</strong>：智能合约的代码一经部署，就无法更改，确保了合约的可靠性和一致性。</li>
<li><strong>去中心化</strong>：智能合约运行在区块链上，没有中央管理者，使得合约的执行更为公正和透明。</li>
</ol>
<p>智能合约可以应用于许多场景，例如资金转移、资产交易、供应链管理、投票系统等。它们的出现为许多传统的合约和交易提供了新的、更高效的解决方案。</p>
<p><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312201126869.png"></p>
<h1 id="项目开发"><a href="#项目开发" class="headerlink" title="项目开发"></a>项目开发</h1><h2 id="web3-连接到以太坊网络（测试网、主网）"><a href="#web3-连接到以太坊网络（测试网、主网）" class="headerlink" title="web3 连接到以太坊网络（测试网、主网）"></a>web3 连接到以太坊网络（测试网、主网）</h2><h3 id="1-什么是-web3"><a href="#1-什么是-web3" class="headerlink" title="1.什么是 web3"></a>1.什么是 web3</h3><p>web3 是以太坊官方提供的一个连接以太坊区块链的模块，允许使用 HTTP 或 IPC 与本地或远程以太坊节点进行交互，它包含以太坊生态系统几乎所有的功能。web3 模块主要连接以太坊暴露出来的 RPC 层。开发者利用 web3 连接 RPC 层，可以连接任何暴露了 RPC 接口的节点，从而与区块链交互。web3 是一个集合库，支持多种开发语言使用 web3，其中的 JavaScript API 叫做 web3.js，另外还有 web3.py，web3j。</p>
<p>web3.eth：用于与以太坊区块链和智能合约之间的交互。</p>
<p>web3.utils：包含一些辅助方法。</p>
<p>web3.shh：用于协议进行通信的 P2P 和广播。</p>
<p>web3.bzz：用于与群网络交互的 Bzz 模块。</p>
<p>web3.js 开发文档：<a target="_blank" rel="noopener" href="https://web3js.readthedocs.io/en/v1.8.1/">https://web3js.readthedocs.io/en/v1.8.1/</a></p>
<p>web3.js 中文文档 : <a target="_blank" rel="noopener" href="https://learnblockchain.cn/docs/web3.js/">https://learnblockchain.cn/docs/web3.js/</a></p>
<h3 id="2-实例化-web3"><a href="#2-实例化-web3" class="headerlink" title="2.实例化 web3"></a>2.实例化 web3</h3><p>web3 要与以坊节点进行交互，需要创建一个 web3 对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Web3</span> = <span class="built_in">require</span>(<span class="string">&quot;web3&quot;</span>);</span><br><span class="line"><span class="comment">// &quot;Web3.providers.givenProvider&quot; will be set if in an Ethereum supported browser.</span></span><br><span class="line"><span class="keyword">var</span> web3 = <span class="keyword">new</span> <span class="title class_">Web3</span>(</span><br><span class="line">  <span class="title class_">Web3</span>.<span class="property">givenProvider</span> || <span class="string">&quot;ws://some.local-or-remote.node:8546&quot;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>根据 API 可知需要指定节点地址，我们将<code>ws://some.local-or-remote.node:8546</code>换成其它连接到以太坊网络的节点的地址，以此来确定连接的以太坊的网络。<br>那么连接到以太坊网络的节点的地址是多少呢？这里我们需要使用到 infura。</p>
<h3 id="3-获取连接到以太坊网络的节点地址"><a href="#3-获取连接到以太坊网络的节点地址" class="headerlink" title="3.获取连接到以太坊网络的节点地址"></a>3.获取连接到以太坊网络的节点地址</h3><p>infura 提供公开的 Ethereum 主网和测试网络节点，到 infura.io 网站注册后即可获取各个网络的地址。请按照如下步骤获取地址。</p>
<p>第一步：打开 <a target="_blank" rel="noopener" href="https://infura.io/dashboard">infura 网站地址</a>，使用邮箱注册后登陆。</p>
<p>第二步：点击上图标记的“create new project”按钮创建一个新项目。然后弹出如下弹框，在输入框输入项目名，如”MyEtherWallet“，然后点击“create project”按钮创建。<br><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312251507913.png"></p>
<p>第三步：然后会显示如下界面，点击下图中的选择框，可以看到提供主网、Kovan测试网络、Ropsten测试网络、GoerLi测试网络的节点地址。</p>
<p><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312251510130.png"><br><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312251511763.png"></p>
<p>第四步：选择GoerLi测试网络，然后复制地址<br><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312251512187.png"></p>
<p>连接到以太坊GoerLi测试网络<br>现在将复制的地址替换掉实例化web对象的地址，如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Web3</span> = <span class="built_in">require</span>(<span class="string">&quot;web3&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> web3 = <span class="keyword">new</span> <span class="title class_">Web3</span>(<span class="title class_">Web3</span>.<span class="property">givenProvider</span> || <span class="string">&#x27;wss://goerli.infura.io/ws/v3/cb7e63cf28244e4499b4b6fb6162e746&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Web3:&quot;</span>, web3)</span><br></pre></td></tr></table></figure>
<p>连接到以太坊主网与GoerLi测试网络一样的，只需复制主网节点的地址去实例化web3即可。由于在主网上交易需要花费gas，因此我们基于GoerLi测试网络进行开发，后续开发完成后可再切换到主网。<br><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312251515346.png"></p>
<h2 id="web3-js-高频API"><a href="#web3-js-高频API" class="headerlink" title="web3.js 高频API"></a>web3.js 高频API</h2><h3 id="1-账号创建"><a href="#1-账号创建" class="headerlink" title="1.账号创建"></a>1.账号创建</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web3.<span class="property">eth</span>.<span class="property">accounts</span>.<span class="title function_">create</span>([entropy]);</span><br></pre></td></tr></table></figure>
<p>参数：</p>
<p>entropy - String (可选): 它是一个可选项，是一个随机字符串，将作为解锁账号的密码。如果没有传递字符串，则使用random生成随机字符串。</p>
<p>返回值：</p>
<p>Object：包含以下字段的一个帐户对象：</p>
<p>address- string：帐户地址。</p>
<p>privateKey- string：帐户私钥。前端永远不应该在localstorage中以未加密的方式共享或存储！</p>
<p>signTransaction(tx [, callback])- Function：签名交易的方法。</p>
<p>sign(data)- Function：签名二进制交易的方法。</p>
<p>示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建账号</span></span><br><span class="line"><span class="keyword">const</span> account = web3.<span class="property">eth</span>.<span class="property">accounts</span>.<span class="title function_">create</span>(<span class="string">&quot;123&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;account=&#x27;</span>,account);</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312251549225.png"></p>
<h3 id="2-获取地址"><a href="#2-获取地址" class="headerlink" title="2.获取地址"></a>2.获取地址</h3><p>使用API <code>web3.eth.accounts.create()</code>创建了新账户后生成了一个账户对象，在该对象中拥有<code>address</code>属性，即账户的私钥。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取地址</span></span><br><span class="line"><span class="keyword">let</span> addr = account.<span class="property">address</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;address = &#x27;</span>,addr);</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312251610782.png"></p>
<h3 id="3-获取私钥"><a href="#3-获取私钥" class="headerlink" title="3.获取私钥"></a>3.获取私钥</h3><p>使用API <code>web3.eth.accounts.create()</code>创建了新账户后生成了一个账户对象，在该对象中拥有<code>privateKey</code>属性，即账户的私钥。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取私钥</span></span><br><span class="line"><span class="keyword">let</span> privateKey = account.<span class="property">privateKey</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;privateKey = &#x27;</span>,privateKey);</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312251613169.png"></p>
<h3 id="4-余额获取"><a href="#4-余额获取" class="headerlink" title="4.余额获取"></a>4.余额获取</h3><p>根据地址获取以wei为单位余额</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// 获取余额</span></span><br><span class="line">  web3.<span class="property">eth</span>.<span class="title function_">getBalance</span>(addr).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="5-单位转换"><a href="#5-单位转换" class="headerlink" title="5.单位转换"></a>5.单位转换</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.Eth 转为 wei</span></span><br><span class="line"><span class="keyword">const</span> num1 = web3.<span class="property">utils</span>.<span class="title function_">toWei</span>(<span class="string">&#x27;0.3&#x27;</span>, <span class="string">&#x27;ether&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;num1=&#x27;</span>,num1);</span><br><span class="line"><span class="comment">// 300000000000000000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. wei 转为Eth</span></span><br><span class="line"><span class="keyword">const</span> balance = <span class="title class_">Web3</span>.<span class="property">utils</span>.<span class="title function_">fromWei</span>(<span class="string">&quot;300000&quot;</span>, <span class="string">&quot;ether&quot;</span>);</span><br><span class="line"><span class="comment">// balance= 0.0000000000003</span></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="6-Eth转账-⚠️存在问题"><a href="#6-Eth转账-⚠️存在问题" class="headerlink" title="6.Eth转账[⚠️存在问题]"></a>6.Eth转账[⚠️存在问题]</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web3.<span class="property">eth</span>.<span class="title function_">sendSignedTransaction</span>(signedTransactionData [, callback])</span><br></pre></td></tr></table></figure>

<p><strong>参数</strong></p>
<ul>
<li><p><code>signedTransactionData</code>-<code>String</code>：以HEX格式签名的交易数据。</p>
<p>交易数据对象可以包含如下字段：</p>
<ul>
<li><code>from</code>- <code>String|Number</code>：发送帐户的地址。如果未指定，则使用web3.eth.defaultAccount属性。或web3.eth.accounts.wallet中本地钱包的地址。</li>
<li><code>to</code>- <code>String</code>:(可选）消息的目标地址，若未定义则为合同发送消息。</li>
<li><code>value</code>- <code>Number|String|BN|BigNumber</code>:(可选）为wei中的交易转移的数量，如果是合约发送消息，则是捐赠给合约地址。</li>
<li><code>gas</code> - <code>Number</code>:(可选，默认：待定）用于交易的gas（未使用的gas会退还）。</li>
<li><code>gasPrice</code>- <code>Number|String|BN|BigNumber</code>:(可选）此交易的gas价格，以wei为单位，默认为<a target="_blank" rel="noopener" href="https://web3js.readthedocs.io/en/1.0/web3-eth.html#eth-gasprice">web3.eth.gasPrice</a>。</li>
<li><code>data</code>- <code>String</code>:(可选）包含合同上函数调用数据的<a target="_blank" rel="noopener" href="http://solidity.readthedocs.io/en/latest/abi-spec.html">ABI字节字符串</a>。</li>
<li><code>nonce</code>- <code>Number</code>:(可选）随机数的整数。</li>
</ul>
</li>
<li><p><code>callback</code>-<code>Function</code>：（可选）可选回调，将错误对象作为第一个参数返回，结果作为第二个参数返回。</p>
</li>
</ul>
<p><strong>返回</strong></p>
<p><code>PromiEvent</code>：promise组合的事件，将在交易完成时调用。包含以下事件</p>
<ul>
<li><code>&quot;transactionHash&quot;</code>返回<code>String</code>：在发送事务并且事务哈希可用之后立即触发。</li>
<li><code>&quot;receipt&quot;</code>返回<code>Object</code>：在交易确认时触发。</li>
<li><code>&quot;confirmation&quot;</code>返回<code>Number</code>，<code>Object</code>：每次确认都会被调用，直到第12次确认。接收确认编号作为第一个参数，将数据作为第二个参数。</li>
<li><code>&quot;error&quot;</code>返回<code>Error</code>：如果在发送过程中发生错误，则会触发。</li>
</ul>
<ol>
<li><p>构建转账参数</p>
<p>区块链转账和支付宝转账类似，需要 <code>发送方</code> 、<code>接收方</code>、<code>金额</code>、<code>密码</code></p>
<p>另外需要添加部分区块链参数：<code>矿工费gas</code>、<code>地址转账交易次数</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取账户交易次数</span></span><br><span class="line"> <span class="keyword">let</span> nonce = <span class="keyword">await</span> web3.<span class="property">eth</span>.<span class="title function_">getTransactionCount</span>(fromaddress);</span><br><span class="line"> <span class="comment">// 获取预计转账gas费</span></span><br><span class="line"> <span class="keyword">let</span> gasPrice = <span class="keyword">await</span> web3.<span class="property">eth</span>.<span class="title function_">getGasPrice</span>();</span><br><span class="line"> <span class="comment">// 转账金额以wei为单位</span></span><br><span class="line"> <span class="keyword">let</span> balance = <span class="keyword">await</span> web3.<span class="property">utils</span>.<span class="title function_">toWei</span>(number);</span><br><span class="line"> <span class="keyword">var</span> rawTx = &#123;</span><br><span class="line">   <span class="attr">from</span>: fromaddress,</span><br><span class="line">   <span class="attr">nonce</span>: nonce,</span><br><span class="line">   <span class="attr">gasPrice</span>: gasPrice,</span><br><span class="line">   <span class="attr">to</span>: toaddress,</span><br><span class="line">   <span class="attr">value</span>: balance,</span><br><span class="line">   <span class="attr">data</span>: <span class="string">&quot;0x00&quot;</span>, <span class="comment">//转Token代币会用到的一个字段</span></span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure></li>
<li><p>通过转账参数计算最终gas费用，并将通过私钥将转账参数进行编码加密<br><strong>⚠️注意：ethereumjs-tx目前已经处于停用状态</strong></p>
<blockquote>
<p>ethereumjs-tx 第三方库请选择1.3.7版本</p>
</blockquote>
</li>
</ol>
   <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Tx</span> <span class="keyword">from</span> <span class="string">&quot;ethereumjs-tx&quot;</span>;  </span><br><span class="line"><span class="comment">// 将私钥去除“ox”后进行hex转化</span></span><br><span class="line">      <span class="keyword">var</span> privateKey = <span class="keyword">new</span> <span class="title class_">Buffer</span>(privatekey.<span class="title function_">slice</span>(<span class="number">2</span>), <span class="string">&quot;hex&quot;</span>);</span><br><span class="line">      <span class="comment">//需要将交易的数据进行预估gas计算，然后将gas值设置到数据参数中</span></span><br><span class="line">      <span class="keyword">let</span> gas = <span class="keyword">await</span> web3.<span class="property">eth</span>.<span class="title function_">estimateGas</span>(rawTx);</span><br><span class="line">      rawTx.<span class="property">gas</span> = gas;</span><br><span class="line">     <span class="comment">// 通过 ethereumjs-tx 实现私钥加密Ï</span></span><br><span class="line">      <span class="keyword">var</span> tx = <span class="keyword">new</span> <span class="title class_">Tx</span>(rawTx);</span><br><span class="line">      tx.<span class="title function_">sign</span>(privateKey);</span><br><span class="line">      <span class="keyword">var</span> serializedTx = tx.<span class="title function_">serialize</span>();</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>通过 <code>sendSignedTransaction</code> api发送转账交易，并且获取交易id</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">web3.<span class="property">eth</span></span><br><span class="line">  .<span class="title function_">sendSignedTransaction</span>(<span class="string">&quot;0x&quot;</span> + serializedTx.<span class="title function_">toString</span>(<span class="string">&quot;hex&quot;</span>))</span><br><span class="line">  .<span class="title function_">on</span>(<span class="string">&quot;transactionHash&quot;</span>, <span class="function">(<span class="params">txid</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;交易成功,请在区块链浏览器查看&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;交易id&quot;</span>, txid);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`https://goerli.etherscan.io/tx/<span class="subst">$&#123;txid&#125;</span>`</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// .on(&#x27;receipt&#x27;, (ret)=&gt;&#123;console.log(&#x27;receipt&#x27;)&#125;)</span></span><br><span class="line">  <span class="comment">// .on(&#x27;confirmation&#x27;, (ret)=&gt;&#123;console.log(&#x27;confirmation&#x27;)&#125;)</span></span><br><span class="line">  .<span class="title function_">on</span>(<span class="string">&quot;error&quot;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;error:&quot;</span> + err);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure></li>
<li><p>区块链浏览器或者目标钱包产看转账结果</p>
<p>goerli区块链浏览器 <a target="_blank" rel="noopener" href="https://goerli.etherscan.io/tx/%E4%BA%A4%E6%98%93id">https://goerli.etherscan.io/tx/交易id</a></p>
</li>
</ol>
<hr>
<h1 id="账户系统"><a href="#账户系统" class="headerlink" title="账户系统"></a>账户系统</h1><h2 id="密码"><a href="#密码" class="headerlink" title="密码"></a><code>密码</code></h2><p>密码不是私钥，它是在创建账户时候的密码（可以修改）<br>密码在以下情况下会使用到：</p>
<ol>
<li>作为转账的支付密码</li>
<li>用keystore导入钱包的时候需要输入的密码，用来解锁keystore的</li>
</ol>
<h2 id="私钥-Private-Key"><a href="#私钥-Private-Key" class="headerlink" title="私钥 Private Key"></a><code>私钥 Private Key</code></h2><p>私钥由64位长度的十六进制的字符组成，比如：<code>0xA4356E49C88C8B7AB370AF7D5C0C54F0261AAA006F6BDE09CD4745CF54E0115A</code>，一个账户只有一个私钥且不能修改。<br>通常一个钱包中私钥和公钥是成对出现的，有了私钥，我们就可以通过一定的算法生成公钥，再通过公钥经过一定的算法生成地址，这一过程都是不可逆的。私钥一定要妥善保管，若被泄漏别人可以通过私钥解锁账号转出你的该账号的数字货币。</p>
<h2 id="公钥-Public-Key"><a href="#公钥-Public-Key" class="headerlink" title="公钥 Public Key"></a><code>公钥 Public Key</code></h2><p>公钥(Public Key)是和私钥成对出现的，和私钥一起组成一个密钥对，保存在钱包中。<em>公钥由私钥生成，但是无法通过公钥倒推得到私钥。公钥能够通过一系列算法运算得到钱包的地址，因此可以作为拥有这个钱包地址的凭证。</em></p>
<h2 id="Keystore"><a href="#Keystore" class="headerlink" title="Keystore"></a><code>Keystore</code></h2><p>Keystore常见于以太坊钱包，它是将私钥以加密的方式保存为一份 JSON 文件，这份 JSON 文件就是 keystore，所以它就是加密后的私钥。Keystore必须配合钱包密码才能导入并使用该账号。当黑客盗取 Keystore 后，在没有密码情况下, 有可能通过暴力破解 Keystore 密码解开 Keystore，所以建议使用者在设置密码时稍微复杂些，比如带上特殊字符，至少 8 位以上，并安全存储。</p>
<h2 id="助记词-Mnemonic"><a href="#助记词-Mnemonic" class="headerlink" title="助记词 Mnemonic"></a><code>助记词 Mnemonic</code></h2><p>私钥是64位长度的十六进制的字符，不利于记录且容易记错，所以用算法将一串随机数转化为了一串12 ~ 24个容易记住的单词，方便保存记录。注意：</p>
<ol>
<li>助记词是私钥的另一种表现形式</li>
<li>助记词=私钥，这是不正确的说法，通过助记词可以获取相关联的多个私钥，但是通过其中一个私钥是不能获取助记词的，因此<strong>助记词≠私钥</strong>。</li>
</ol>
<h2 id="BIP"><a href="#BIP" class="headerlink" title="BIP"></a><code>BIP</code></h2><p>要弄清楚助记词与私钥的关系，得清楚BIP协议，是<code>Bitcoin Improvement Proposals</code>的缩写，意思是Bitcoin 的改进建议，用于提出 Bitcoin 的新功能或改进措施。BIP协议衍生了很多的版本，主要有BIP32、BIP39、BIP44。</p>
<p><strong>BIP32</strong></p>
<p>BIP32是 HD钱包的核心提案，通过种子来生成主私钥，然后派生海量的子私钥和地址，种子是一串很长的随机数。</p>
<p><strong>BIP39</strong></p>
<p>由于种子是一串很长的随机数，不利于记录，所以我们用算法将种子转化为一串12 ~ 24个的单词，方便保存记录，这就是BIP39，它扩展了 HD钱包种子的生成算法。</p>
<p><strong>BIP44</strong></p>
<p>BIP44 是在 BIP32 和 BIP43 的基础上增加多币种，提出的层次结构非常全面，它允许处理多个币种，多个帐户，每个帐户有数百万个地址。</p>
<p>在BIP32路径中定义以下5个级别：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m/purpose&#x27;/coin_type&#x27;/account&#x27;/change/address_index</span><br></pre></td></tr></table></figure>

<ul>
<li>purpose：在BIP43之后建议将常数设置为44’。表示根据BIP44规范使用该节点的子树。</li>
<li>Coin_type：币种，代表一个主节点（种子）可用于无限数量的独立加密币，如比特币，Litecoin或Namecoin。此级别为每个加密币创建一个单独的子树，避免重用已经在其它链上存在的地址。开发人员可以为他们的项目注册未使用的号码。</li>
<li>Account：账户，此级别为了设置独立的用户身份可以将所有币种放在一个的帐户中，从0开始按顺序递增。</li>
<li>Change：常量0用于外部链，常量1用于内部链，外部链用于钱包在外部用于接收和付款。内部链用于在钱包外部不可见的地址，如返回交易变更。</li>
<li>Address_index：地址索引，按顺序递增的方式从索引0开始编号。</li>
</ul>
<p>BIP44的规则使得 HD钱包非常强大，用户只需要保存一个种子，就能控制所有币种，所有账户的钱包，因此由BIP39 生成的助记词非常重要，所以一定安全妥善保管，那么会不会被破解呢？如果一个 HD 钱包助记词是 12 个单词，一共有 2048 个单词可能性，那么随机的生成的助记词所有可能性大概是<code>5e+39</code>，因此几乎不可能被破解。</p>
<h2 id="HD钱包"><a href="#HD钱包" class="headerlink" title="HD钱包"></a><code>HD钱包</code></h2><p>通过BIP协议生成账号的钱包叫做HD钱包。这个HD钱包，并不是Hardware Wallet硬件钱包，这里的 HD 是<code>Hierarchical Deterministic</code>的缩写，意思是分层确定性，所以HD钱包的全称为比特币分成确定性钱包 。</p>
<h2 id="密码、私钥、keystore与助记词的关系"><a href="#密码、私钥、keystore与助记词的关系" class="headerlink" title="密码、私钥、keystore与助记词的关系"></a>密码、私钥、keystore与助记词的关系</h2><p><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312261553646.png"></p>
<h2 id="钱包的核心：私钥"><a href="#钱包的核心：私钥" class="headerlink" title="钱包的核心：私钥"></a>钱包的核心：私钥</h2><p>基于以上的分析，我们对以太坊钱包的账号系统有了一个很好的认识，那么我们在使用钱包的过程中，该如何保管自己的钱包呢？主要包含以下几种方式：</p>
<ul>
<li>私钥（Private Key）</li>
<li>Keystore+密码（Keystore+Password）</li>
<li>助记词（Mnemonic code）</li>
</ul>
<p>通过以上三种中的一种方式都可以解锁账号，然后掌控它，所以对于每种方式中的数据都必须妥善包括，如有泄漏，请尽快转移数字资产。</p>
<p>我们可以得到以下总结：</p>
<ul>
<li>通过私钥+密码可以生成keystore，即加密私钥；</li>
<li>通过keystore+密码可以获取私钥，即解密keystore。</li>
<li>通过助记词根据不同的路径获取不同的私钥，即使用HD钱包将助记词转化成种子来生成主私钥，然后派生海量的子私钥和地址。</li>
</ul>
<h2 id="通过助记词-创建账户"><a href="#通过助记词-创建账户" class="headerlink" title="通过助记词 - 创建账户"></a>通过助记词 - 创建账户</h2><p>需要使用<code>bip39</code>协议将助记词转换成种子，再通过<code>ethereumjs-wallet</code>库生成hd钱包，根据路径的不同从hd钱包中获取不同的keypair，keypair中就包含有公钥、私钥，再通过<code>ethereumjs-util</code>库将公钥生成地址，从而根据助记词获取所有关联的账号，能获取到公钥、私钥、地址等数据信息。</p>
<p><strong>1.依赖库</strong><br>需要用到三个库：bip39、ethereumjs-wallet/hdkey、ethereumjs-util。先安装依赖库，<code>cd</code>到项目跟路径运行命令<code>npm i bip39 ethereumjs-wallet ethereumjs-util</code>。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/bitcoinjs/bip39">bip39</a>：随机产生新的 mnemonic code，并可以将其转成 binary 的 seed。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/ethereumjs/ethereumjs-wallet">ethereumjs-wallet</a>：生成和管理公私钥，下面使用其中 hdkey 子套件来创建 HD 钱包。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/ethereumjs/ethereumjs-util">ethereumjs-util</a>：Ethereum 的一个工具库。</li>
<li><a target="_blank" rel="noopener" href="https://iancoleman.io/bip39/">https://iancoleman.io/bip39/</a></li>
</ul>
<p><strong>2.通过助记词创建账号</strong></p>
<ul>
<li><p>创建助记词</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入bip39模块</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> bip39 <span class="keyword">from</span> <span class="string">&quot;bip39&quot;</span>;</span><br><span class="line"><span class="comment">// 创建助记词 </span></span><br><span class="line"><span class="keyword">let</span> mnemonic = bip39.<span class="title function_">generateMnemonic</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(mnemonic);</span><br><span class="line"><span class="comment">// 结果 12位助记词</span></span><br><span class="line"><span class="comment">// vote select solar shy embrace immense lizard stamp scrub vague negative forward</span></span><br></pre></td></tr></table></figure></li>
<li><p>根据助记词生成密钥对 keypair</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入分层钱包模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; hdkey &#125; <span class="keyword">from</span> <span class="string">&quot;ethereumjs-wallet&quot;</span>;</span><br><span class="line"><span class="comment">//1.将助记词转成seed</span></span><br><span class="line"><span class="keyword">let</span> seed = <span class="keyword">await</span> bip39.<span class="title function_">mnemonicToSeed</span>(<span class="string">&quot;12位助记词&quot;</span>);</span><br><span class="line"><span class="comment">//3.通过hdkey将seed生成HD Wallet</span></span><br><span class="line"><span class="keyword">let</span> hdWallet = hdkey.<span class="title function_">fromMasterSeed</span>(seed);</span><br><span class="line"><span class="comment">//4.生成钱包中在m/44&#x27;/60&#x27;/0&#x27;/0/i路径的keypair</span></span><br><span class="line"><span class="keyword">let</span> keypair = hdWallet.<span class="title function_">derivePath</span>(<span class="string">&quot;m/44&#x27;/60&#x27;/0&#x27;/0/0&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(keypair);</span><br><span class="line">   </span><br></pre></td></tr></table></figure>
<p>keypair 密钥对<br><img src="https://cdn.jsdelivr.net/gh/qw-null/BlogImages/202312291458907.png"></p>
</li>
</ul>
<p><strong>3. 由keypair 获取钱包地址和私钥</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取钱包对象</span></span><br><span class="line"><span class="keyword">let</span> wallet = keypair.<span class="title function_">getWallet</span>();</span><br><span class="line"><span class="comment">// 获取钱包地址</span></span><br><span class="line"><span class="keyword">let</span> lowerCaseAddress = wallet.<span class="title function_">getAddressString</span>();</span><br><span class="line"><span class="comment">// 获取钱包校验地址</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">CheckSumAddress</span> = wallet.<span class="title function_">getChecksumAddressString</span>();</span><br><span class="line"><span class="comment">// 获取私钥</span></span><br><span class="line"><span class="keyword">let</span> prikey = wallet.<span class="title function_">getPrivateKey</span>().<span class="title function_">toString</span>(<span class="string">&quot;hex&quot;</span>);</span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;lowerCaseAddress&quot;</span>, lowerCaseAddress);</span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;CheckSumAddress&quot;</span>, <span class="title class_">CheckSumAddress</span>);</span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;prikey&quot;</span>, prikey);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">lowerCaseAddress 0xd9fc0fd4412616c7075e68b151ab3a7bcb9a3f54</span></span><br><span class="line"><span class="comment">CheckSumAddress 0xd9fC0FD4412616c7075E68b151ab3A7bcB9A3f54</span></span><br><span class="line"><span class="comment">prikey 3fc11495517f1f015bbcb6c311da66e3b26b23e4c91c1285ccc4b69d9d274002</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="导出账户"><a href="#导出账户" class="headerlink" title="导出账户"></a>导出账户</h2><blockquote>
<p>一个已经存在的账户导出 私钥 和 keystore</p>
</blockquote>
<ol>
<li>通过分层钱包对象 + 密码 创建keystore<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> keystore = <span class="keyword">await</span> wallet.<span class="title function_">toV3</span>(data.<span class="property">pass1</span>); <span class="comment">// 参数必须为 字符串</span></span><br></pre></td></tr></table></figure></li>
<li>通过私钥和密码创建 keystore <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> keystore = <span class="keyword">await</span> web3.<span class="property">eth</span>.<span class="property">accounts</span>.<span class="title function_">encrypt</span>(<span class="string">&quot;账户私钥&quot;</span>,<span class="string">&quot;密码&quot;</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模拟keystore数据</span></span><br><span class="line"><span class="keyword">const</span> keystoreJsonV3 = &#123;</span><br><span class="line">        <span class="attr">version</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="string">&quot;dbb70fb2-52ad-4e1f-9c19-0b50329f89c3&quot;</span>,</span><br><span class="line">        <span class="attr">address</span>: <span class="string">&quot;445b469888528dacd9b87246c5ce70407adaa411&quot;</span>,</span><br><span class="line">        <span class="attr">crypto</span>: &#123;</span><br><span class="line">          <span class="attr">ciphertext</span>:</span><br><span class="line">            <span class="string">&quot;1e53e7e775644422600188b8134907992db40d278064ea3a966da4dcdf80db64&quot;</span>,</span><br><span class="line">          <span class="attr">cipherparams</span>: &#123; <span class="attr">iv</span>: <span class="string">&quot;f9d2b047019674eee449b316f4a21491&quot;</span> &#125;,</span><br><span class="line">          <span class="attr">cipher</span>: <span class="string">&quot;aes-128-ctr&quot;</span>,</span><br><span class="line">          <span class="attr">kdf</span>: <span class="string">&quot;scrypt&quot;</span>,</span><br><span class="line">          <span class="attr">kdfparams</span>: &#123;</span><br><span class="line">            <span class="attr">dklen</span>: <span class="number">32</span>,</span><br><span class="line">            <span class="attr">salt</span>: <span class="string">&quot;153e074d78d0ba36fae3e46e582c42e53f61653cb5d4f1a3a3f68094e6ca0160&quot;</span>,</span><br><span class="line">            <span class="attr">n</span>: <span class="number">8192</span>,</span><br><span class="line">            <span class="attr">r</span>: <span class="number">8</span>,</span><br><span class="line">            <span class="attr">p</span>: <span class="number">1</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">mac</span>: <span class="string">&quot;e91456c59b2505c16b80c2495ab7b4633273c2ae366cb6953f27de8cfebad629&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;;</span><br><span class="line"> <span class="keyword">const</span> res = web3.<span class="property">eth</span>.<span class="property">accounts</span>.<span class="title function_">decrypt</span>(keystoreJsonV3, <span class="string">&quot;1235&quot;</span>);</span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br></pre></td></tr></table></figure></li>
<li>通过keystore解密私钥<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ethwallet <span class="keyword">from</span> <span class="string">&quot;ethereumjs-wallet&quot;</span>;  </span><br><span class="line">   <span class="keyword">let</span> pass = <span class="title function_">prompt</span>(<span class="string">&quot;请输入密码&quot;</span>);</span><br><span class="line">       <span class="keyword">let</span> wallet;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">         wallet = <span class="keyword">await</span> ethwallet.<span class="title function_">fromV3</span>(keystore, pass);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">         <span class="title function_">alert</span>(<span class="string">&quot;密码错误&quot;</span>);</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   <span class="keyword">let</span> key = wallet.<span class="title function_">getPrivateKey</span>().<span class="title function_">toString</span>(<span class="string">&quot;hex&quot;</span>);</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="导入账户"><a href="#导入账户" class="headerlink" title="导入账户"></a>导入账户</h2><blockquote>
<p>通过 私钥、助记词、keystore 导入一个已经存在的钱包账户 地址 和 私钥</p>
</blockquote>
<ol>
<li>通过keystore获取 私钥和地址 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ethwallet <span class="keyword">from</span> <span class="string">&quot;ethereumjs-wallet&quot;</span>;  </span><br><span class="line">  <span class="keyword">let</span> pass = <span class="title function_">prompt</span>(<span class="string">&quot;请输入密码&quot;</span>);</span><br><span class="line">      <span class="keyword">let</span> wallet;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        wallet = <span class="keyword">await</span> ethwallet.<span class="title function_">fromV3</span>(keystore, pass);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;密码错误&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="keyword">let</span> key = wallet.<span class="title function_">getPrivateKey</span>().<span class="title function_">toString</span>(<span class="string">&quot;hex&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> address = wallet.<span class="title function_">getAddressString</span>()</span><br></pre></td></tr></table></figure></li>
<li>通过助记词 获取地址和私钥<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mnemonic=<span class="title function_">prompt</span>(<span class="string">&quot;请输入助记词&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> seed = bip39.<span class="title function_">mnemonicToSeed</span>(mnemonic)</span><br><span class="line"><span class="keyword">let</span> hdwallet = hdkey.<span class="title function_">fromMasterSeed</span>(seed)</span><br><span class="line"><span class="keyword">let</span> keypair = hdWallet.<span class="title function_">derivePath</span>(<span class="string">&quot;m/44&#x27;/60&#x27;/0&#x27;/0/0&quot;</span>);</span><br><span class="line"><span class="comment">// 获取钱包对象</span></span><br><span class="line"><span class="keyword">let</span> wallet = keypair.<span class="title function_">getWallet</span>();</span><br><span class="line"><span class="comment">// 获取钱包地址</span></span><br><span class="line"><span class="keyword">let</span> lowerCaseAddress = wallet.<span class="title function_">getAddressString</span>();</span><br><span class="line"><span class="comment">// 获取钱包校验地址</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">CheckSumAddress</span> = wallet.<span class="title function_">getChecksumAddressString</span>();</span><br><span class="line"><span class="comment">// 获取私钥</span></span><br><span class="line"><span class="keyword">let</span> prikey = wallet.<span class="title function_">getPrivateKey</span>().<span class="title function_">toString</span>(<span class="string">&quot;hex&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li>通过私钥获取 地址<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ethwallet <span class="keyword">from</span> <span class="string">&quot;ethereumjs-wallet&quot;</span>;     </span><br><span class="line"><span class="keyword">let</span> privatekey=<span class="keyword">new</span> <span class="title class_">Buffer</span>( <span class="title function_">prompt</span>(<span class="string">&quot;请输入私钥&quot;</span>), <span class="string">&#x27;hex&#x27;</span> )</span><br><span class="line"><span class="keyword">let</span> wallet = ethwallet.<span class="title function_">fromPrivateKey</span>(privatekey)</span><br><span class="line"><span class="comment">// 获取钱包地址</span></span><br><span class="line"><span class="keyword">let</span> lowerCaseAddress = wallet.<span class="title function_">getAddressString</span>();</span><br></pre></td></tr></table></figure></li>
</ol>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">qinwei</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://qw-null.github.io/2023/12/19/Web3-0DeFi项目实战开发/">https://qw-null.github.io/2023/12/19/Web3-0DeFi项目实战开发/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://qw-null.github.io">QW's Blog</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/">区块链</a><a class="post-meta__tags" href="/tags/web3/">web3</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2023/12/29/Solidity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%F0%9F%93%92/"><i class="fa fa-chevron-left">  </i><span>Solidity学习笔记📒</span></a></div><div class="next-post pull-right"><a href="/2023/11/29/CentOS7%E5%AE%89%E8%A3%85Mysql5-7%EF%BC%88ARM%E7%BB%93%E6%9E%84%EF%BC%89/"><span>CentOS7安装Mysql5.7（ARM架构）</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '44447f6848cb1055dfc7',
  clientSecret: '62722601a7b62e7a2f93add8216a30d9f047a2eb',
  repo: 'CommentData',
  owner: 'qw-null',
  admin: 'qw-null',
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN'
})
gitalk.render('gitalk-container')</script></div></div><footer class="footer-bg" style="background-image: url(https://cdn.jsdelivr.net/gh/qw-null/BlogImages/223.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2021 - 2024 By qinwei</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.1"></script><script src="/js/fancybox.js?version=1.9.1"></script><script src="/js/sidebar.js?version=1.9.1"></script><script src="/js/copy.js?version=1.9.1"></script><script src="/js/fireworks.js?version=1.9.1"></script><script src="/js/transition.js?version=1.9.1"></script><script src="/js/scroll.js?version=1.9.1"></script><script src="/js/head.js?version=1.9.1"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>