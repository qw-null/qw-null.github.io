---
title: CDN加速原理
date: 2022-09-21 21:06:20
tags:
- 面试
---

## 1.什么是CDN？
`CDN的`全称是(`Content Delivery Network`)，即内容分发网络。
其目的是通过在现有的`Internet`中增加一层新的`CACHE`(缓存)层，将网站的内容发布到最接近用户的网络”边缘“的节点，使用户可以就近取得所需的内容，提高用户访问网站的响应速度。从技术上全面解决由于网络带宽小、用户访问量大、网点分布不均等原因，提高用户访问网站的响应速度。
🪐 简单的说，CDN的工作原理就是将源站的资源缓存到位于全球各地的CDN节点上，用户请求资源时，就近返回节点上缓存的资源，而不需要每个用户的请求都回您的源站获取，避免网络拥塞、缓解源站压力，保证用户访问资源的速度和体验。
![](https://cdn.jsdelivr.net/gh/qw-null/BlogImages/20220921211208.png)

CDN对网络的优化作用：
+ 解决服务器端的“第一公里”问题
+ 缓解甚至消除了不同运营商之间互联的瓶颈造成的影响
+ 减轻了各省的出口带宽压力
+ 缓解了骨干网的压力
+ 优化了网上热点内容的分布

## 2.CDN工作原理

传统访问过程：
![](https://cdn.jsdelivr.net/gh/qw-null/BlogImages/20220921215533.png)

由上图可见，用户访问未使用CDN缓存网站的过程为:
1.用户输入访问的域名,操作系统向 LocalDns 查询域名的ip地址.
2.LocalDns向 ROOT DNS 查询域名的授权服务器(这里假设LocalDns缓存过期)
3.ROOT DNS将域名授权dns记录回应给 LocalDns
4.LocalDns得到域名的授权dns记录后,继续向域名授权dns查询域名的ip地址
5.域名授权dns 查询域名记录后，回应给 LocalDns
6.LocalDns 将得到的域名ip地址，回应给 用户端
  -上述过程为DNS解析
7.用户得到域名ip地址后，访问站点服务器
8.站点服务器应答请求，将内容返回给客户端.

![](https://cdn.jsdelivr.net/gh/qw-null/BlogImages/20220921222606.png)
通过上图，我们可以了解到，使用了CDN缓存后的网站的访问过程变为：
1.用户输入访问的域名,操作系统向 LocalDns 查询域名的ip地址.
2.LocalDns向 ROOT DNS 查询域名的授权服务器(这里假设LocalDns缓存过期)
3.ROOT DNS将域名授权dns记录回应给 LocalDns
4.LocalDns得到域名的授权dns记录后,继续向域名授权dns查询域名的ip地址
5.域名授权dns 查询域名记录后(一般是CNAME)，回应给 LocalDns
6.LocalDns 得到域名记录后,向智能调度DNS查询域名的ip地址
7.智能调度DNS 根据一定的算法和策略(比如静态拓扑，容量等),将最适合的CDN节点ip地址回应给 LocalDns
8.LocalDns 将得到的域名ip地址，回应给 用户端
9.用户得到域名ip地址后，访问站点服务器
10.CDN节点服务器应答请求，将内容返回给客户端.(缓存服务器一方面在本地进行保存，以备以后使用，二方面把获取的数据返回给客户端，完成数据服务过程)

**CDN网络的组成元素：**
对于普通的Internet用户，每个CDN节点就相当于一个放置在它周围的网站服务器. 通过对dns的接管，用户的请求被透明地指向离他最近的节点，节点中CDN服务器会像网站的原始服务器一样，响应用户的请求. 由于它离用户更近，因而响应时间必然更快.

从上面图中 虚线圈起来的那块，就是CDN层,这层是位于 用户端 和 站点服务器 之间.
+ 智能调度DNS(比如f5的3DNS)
智能调度DNS是CDN服务中的关键系统.当用户访问加入CDN服务的网站时，域名解析请求将最终由 “智能调度DNS”负责处理。它通过一组预先定义好的策略，将当时最接近用户的节点地址提供给用户，使用户可以得到快速的服务。同时它需要与分布在各地的CDN节点保持通信，跟踪各节点的健康状态、容量等信息，确保将用户的请求分配到就近可用的节点上.

+ 缓存功能服务
负载均衡设备(如lvs,F5的BIG/IP)
内容Cache服务器(如squid）
共享存储